<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证 | SteamedFish&#39;s Blog</title>
<meta name="keywords" content="Filter, Interceptor, JWT令牌, SpringBoot框架, 会话技术, 实战项目, 拦截器, 过滤器, 登录校验">
<meta name="description" content="登录功能
分析
阅读接口文档——登录
了解需求之后分析三层架构各自的任务






    


       
    




  
    
  
    
  




实体类

EmpLoginInfo.java
package com.javaweb.entity;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class EmpLoginInfo {
    private Integer id;
    private String username;
    private String name;
    private String token;
}



Controller

LoginController.java
package com.javaweb.controller;

import com.javaweb.entity.Emp;
import com.javaweb.entity.EmpLoginInfo;
import com.javaweb.entity.Result;
import com.javaweb.service.EmpService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
@RequestMapping(&#34;/login&#34;)
public class LoginController {
    @Autowired
    private EmpService empService;

    /**
     * 员工登录
     *
     * @param emp
     * @return
     */
    @PostMapping
    public Result login(@RequestBody Emp emp) {
        log.info(&#34;员工登录：{}&#34;, emp);
        EmpLoginInfo loginInfo = empService.login(emp);
        if (loginInfo == null) {
            return Result.error(&#34;用户名或密码错误！！&#34;);
        }
        return Result.success(loginInfo);
    }
}



Service &amp; Mapper

EmpServiceImpl.java
/**
 * 员工登录
 *
 * @param emp
 * @return
 */
@Override
public EmpLoginInfo login(Emp emp) {
    //1.调用mapper方法查询
    Emp empDB = empMapper.selectByUsernameAndPassword(emp);
    //2.判断登录数据是否正确
    if (empDB != null) {
        //3.查到数据构造EmpLoginInfo对象并返回
        //TODO
        return new EmpLoginInfo(empDB.getId(), empDB.getUsername(), empDB.getName(), null);
    }
    //3.如果数据为空，代表登录失败，返回null
    return null;
}

EmpMapper.xml
&lt;!--  登录--&gt;
&lt;select id=&#34;selectByUsernameAndPassword&#34; resultType=&#34;com.javaweb.entity.Emp&#34;&gt;
    select *
    from emp
    where username = #{username}
      and password = #{password}
&lt;/select&gt;



联调测试

问题：在未登录时，也能访问系统页面进行操作
解决方案：进行登录校验


登录校验






    


       
    




  
    
  
    
  





    
        
            
        注释">
<meta name="author" content="">
<link rel="canonical" href="https://www.steamedfish.top/post/java-web/javaweb-20-springboot-tlias9/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bb75ad9cd3f177416820549c7dcf1fbd230a3e6d5746d0421cdd343c8a204e05.css" integrity="sha256-u3WtnNPxd0FoIFScfc8fvSMKPm1XRtBCHN00PIogTgU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.steamedfish.top/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.steamedfish.top/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.steamedfish.top/favicon.png">
<link rel="apple-touch-icon" href="https://www.steamedfish.top/favicon.png">
<link rel="mask-icon" href="https://www.steamedfish.top/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://www.steamedfish.top/post/java-web/javaweb-20-springboot-tlias9/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>





<link
  href="/fonts/lxgw/style.css"
  rel="stylesheet"
/><meta property="og:url" content="https://www.steamedfish.top/post/java-web/javaweb-20-springboot-tlias9/">
  <meta property="og:site_name" content="SteamedFish&#39;s Blog">
  <meta property="og:title" content="Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证">
  <meta property="og:description" content="登录功能 分析 阅读接口文档——登录
了解需求之后分析三层架构各自的任务 实体类 EmpLoginInfo.java package com.javaweb.entity; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class EmpLoginInfo { private Integer id; private String username; private String name; private String token; } Controller LoginController.java package com.javaweb.controller; import com.javaweb.entity.Emp; import com.javaweb.entity.EmpLoginInfo; import com.javaweb.entity.Result; import com.javaweb.service.EmpService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @Slf4j @RestController @RequestMapping(&#34;/login&#34;) public class LoginController { @Autowired private EmpService empService; /** * 员工登录 * * @param emp * @return */ @PostMapping public Result login(@RequestBody Emp emp) { log.info(&#34;员工登录：{}&#34;, emp); EmpLoginInfo loginInfo = empService.login(emp); if (loginInfo == null) { return Result.error(&#34;用户名或密码错误！！&#34;); } return Result.success(loginInfo); } } Service &amp; Mapper EmpServiceImpl.java /** * 员工登录 * * @param emp * @return */ @Override public EmpLoginInfo login(Emp emp) { //1.调用mapper方法查询 Emp empDB = empMapper.selectByUsernameAndPassword(emp); //2.判断登录数据是否正确 if (empDB != null) { //3.查到数据构造EmpLoginInfo对象并返回 //TODO return new EmpLoginInfo(empDB.getId(), empDB.getUsername(), empDB.getName(), null); } //3.如果数据为空，代表登录失败，返回null return null; } EmpMapper.xml &lt;!-- 登录--&gt; &lt;select id=&#34;selectByUsernameAndPassword&#34; resultType=&#34;com.javaweb.entity.Emp&#34;&gt; select * from emp where username = #{username} and password = #{password} &lt;/select&gt; 联调测试 问题：在未登录时，也能访问系统页面进行操作 解决方案：进行登录校验 登录校验 注释">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-12-05T21:46:13+08:00">
    <meta property="article:modified_time" content="2025-12-10T02:45:12+08:00">
    <meta property="article:tag" content="Filter">
    <meta property="article:tag" content="Interceptor">
    <meta property="article:tag" content="JWT令牌">
    <meta property="article:tag" content="SpringBoot框架">
    <meta property="article:tag" content="会话技术">
    <meta property="article:tag" content="实战项目">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证">
<meta name="twitter:description" content="登录功能
分析
阅读接口文档——登录
了解需求之后分析三层架构各自的任务






    


       
    




  
    
  
    
  




实体类

EmpLoginInfo.java
package com.javaweb.entity;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class EmpLoginInfo {
    private Integer id;
    private String username;
    private String name;
    private String token;
}



Controller

LoginController.java
package com.javaweb.controller;

import com.javaweb.entity.Emp;
import com.javaweb.entity.EmpLoginInfo;
import com.javaweb.entity.Result;
import com.javaweb.service.EmpService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@Slf4j
@RestController
@RequestMapping(&#34;/login&#34;)
public class LoginController {
    @Autowired
    private EmpService empService;

    /**
     * 员工登录
     *
     * @param emp
     * @return
     */
    @PostMapping
    public Result login(@RequestBody Emp emp) {
        log.info(&#34;员工登录：{}&#34;, emp);
        EmpLoginInfo loginInfo = empService.login(emp);
        if (loginInfo == null) {
            return Result.error(&#34;用户名或密码错误！！&#34;);
        }
        return Result.success(loginInfo);
    }
}



Service &amp; Mapper

EmpServiceImpl.java
/**
 * 员工登录
 *
 * @param emp
 * @return
 */
@Override
public EmpLoginInfo login(Emp emp) {
    //1.调用mapper方法查询
    Emp empDB = empMapper.selectByUsernameAndPassword(emp);
    //2.判断登录数据是否正确
    if (empDB != null) {
        //3.查到数据构造EmpLoginInfo对象并返回
        //TODO
        return new EmpLoginInfo(empDB.getId(), empDB.getUsername(), empDB.getName(), null);
    }
    //3.如果数据为空，代表登录失败，返回null
    return null;
}

EmpMapper.xml
&lt;!--  登录--&gt;
&lt;select id=&#34;selectByUsernameAndPassword&#34; resultType=&#34;com.javaweb.entity.Emp&#34;&gt;
    select *
    from emp
    where username = #{username}
      and password = #{password}
&lt;/select&gt;



联调测试

问题：在未登录时，也能访问系统页面进行操作
解决方案：进行登录校验


登录校验






    


       
    




  
    
  
    
  





    
        
            
        注释">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://www.steamedfish.top/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证",
      "item": "https://www.steamedfish.top/post/java-web/javaweb-20-springboot-tlias9/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证",
  "name": "Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证",
  "description": "登录功能 分析 阅读接口文档——登录\n了解需求之后分析三层架构各自的任务 实体类 EmpLoginInfo.java package com.javaweb.entity; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class EmpLoginInfo { private Integer id; private String username; private String name; private String token; } Controller LoginController.java package com.javaweb.controller; import com.javaweb.entity.Emp; import com.javaweb.entity.EmpLoginInfo; import com.javaweb.entity.Result; import com.javaweb.service.EmpService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @Slf4j @RestController @RequestMapping(\u0026#34;/login\u0026#34;) public class LoginController { @Autowired private EmpService empService; /** * 员工登录 * * @param emp * @return */ @PostMapping public Result login(@RequestBody Emp emp) { log.info(\u0026#34;员工登录：{}\u0026#34;, emp); EmpLoginInfo loginInfo = empService.login(emp); if (loginInfo == null) { return Result.error(\u0026#34;用户名或密码错误！！\u0026#34;); } return Result.success(loginInfo); } } Service \u0026amp; Mapper EmpServiceImpl.java /** * 员工登录 * * @param emp * @return */ @Override public EmpLoginInfo login(Emp emp) { //1.调用mapper方法查询 Emp empDB = empMapper.selectByUsernameAndPassword(emp); //2.判断登录数据是否正确 if (empDB != null) { //3.查到数据构造EmpLoginInfo对象并返回 //TODO return new EmpLoginInfo(empDB.getId(), empDB.getUsername(), empDB.getName(), null); } //3.如果数据为空，代表登录失败，返回null return null; } EmpMapper.xml \u0026lt;!-- 登录--\u0026gt; \u0026lt;select id=\u0026#34;selectByUsernameAndPassword\u0026#34; resultType=\u0026#34;com.javaweb.entity.Emp\u0026#34;\u0026gt; select * from emp where username = #{username} and password = #{password} \u0026lt;/select\u0026gt; 联调测试 问题：在未登录时，也能访问系统页面进行操作 解决方案：进行登录校验 登录校验 注释\n",
  "keywords": [
    "Filter", "Interceptor", "JWT令牌", "SpringBoot框架", "会话技术", "实战项目", "拦截器", "过滤器", "登录校验"
  ],
  "articleBody": "登录功能 分析 阅读接口文档——登录\n了解需求之后分析三层架构各自的任务 实体类 EmpLoginInfo.java package com.javaweb.entity; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @AllArgsConstructor @NoArgsConstructor public class EmpLoginInfo { private Integer id; private String username; private String name; private String token; } Controller LoginController.java package com.javaweb.controller; import com.javaweb.entity.Emp; import com.javaweb.entity.EmpLoginInfo; import com.javaweb.entity.Result; import com.javaweb.service.EmpService; import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @Slf4j @RestController @RequestMapping(\"/login\") public class LoginController { @Autowired private EmpService empService; /** * 员工登录 * * @param emp * @return */ @PostMapping public Result login(@RequestBody Emp emp) { log.info(\"员工登录：{}\", emp); EmpLoginInfo loginInfo = empService.login(emp); if (loginInfo == null) { return Result.error(\"用户名或密码错误！！\"); } return Result.success(loginInfo); } } Service \u0026 Mapper EmpServiceImpl.java /** * 员工登录 * * @param emp * @return */ @Override public EmpLoginInfo login(Emp emp) { //1.调用mapper方法查询 Emp empDB = empMapper.selectByUsernameAndPassword(emp); //2.判断登录数据是否正确 if (empDB != null) { //3.查到数据构造EmpLoginInfo对象并返回 //TODO return new EmpLoginInfo(empDB.getId(), empDB.getUsername(), empDB.getName(), null); } //3.如果数据为空，代表登录失败，返回null return null; } EmpMapper.xml ",
  "wordCount" : "4327",
  "inLanguage": "zh",
  "datePublished": "2025-12-05T21:46:13+08:00",
  "dateModified": "2025-12-10T02:45:12+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.steamedfish.top/post/java-web/javaweb-20-springboot-tlias9/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "SteamedFish's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.steamedfish.top/favicon.png"
    }
  }
}
</script>
</head>

<body data-barba="wrapper" class="" id="top">
<div id="aplayer"></div>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.steamedfish.top/" accesskey="h" title="SteamedFish&#39;s Blog (Alt + H)">SteamedFish&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="https://www.steamedfish.top/en/" title="English"
                                aria-label="English">En</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.steamedfish.top/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main" data-barba="container" data-barba-namespace="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Javaweb——(20)SpringBoot实战·Tlias智能学习辅助系统·登录认证
    </h1>
    <div class="post-meta">






<span title='2025-12-05 21:46:13 +0800 +0800'>2025-12-05</span>&nbsp;·&nbsp;<span title='2025-12-10 02:45:12 +0800 +0800'>(最后修改于 2025-12-10)</span>&nbsp;·&nbsp;<span>9 分钟</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e5%8a%9f%e8%83%bd" aria-label="登录功能">登录功能</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e6%9e%90" aria-label="分析">分析</a></li>
                <li>
                    <a href="#%e5%ae%9e%e4%bd%93%e7%b1%bb" aria-label="实体类">实体类</a></li>
                <li>
                    <a href="#controller" aria-label="Controller">Controller</a></li>
                <li>
                    <a href="#service--mapper" aria-label="Service &amp; Mapper">Service &amp; Mapper</a></li>
                <li>
                    <a href="#%e8%81%94%e8%b0%83%e6%b5%8b%e8%af%95" aria-label="联调测试">联调测试</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e6%a0%a1%e9%aa%8c" aria-label="登录校验">登录校验</a><ul>
                        
                <li>
                    <a href="#%e4%bc%9a%e8%af%9d%e6%8a%80%e6%9c%af" aria-label="会话技术">会话技术</a></li>
                <li>
                    <a href="#jwt%e4%bb%a4%e7%89%8c" aria-label="JWT令牌">JWT令牌</a><ul>
                        
                <li>
                    <a href="#%e4%bb%8b%e7%bb%8d" aria-label="介绍">介绍</a></li>
                <li>
                    <a href="#%e7%94%9f%e6%88%90" aria-label="生成">生成</a></li>
                <li>
                    <a href="#%e8%a7%a3%e6%9e%90" aria-label="解析">解析</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e7%94%9f%e6%88%90%e4%bb%a4%e7%89%8c" aria-label="登录——生成令牌">登录——生成令牌</a></li>
                <li>
                    <a href="#%e8%bf%87%e6%bb%a4%e5%99%a8filter" aria-label="过滤器Filter">过滤器Filter</a><ul>
                        
                <li>
                    <a href="#filter%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8" aria-label="Filter快速入门">Filter快速入门</a></li>
                <li>
                    <a href="#filter%e8%af%a6%e8%a7%a3%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b%e6%8b%a6%e6%88%aa%e8%b7%af%e5%be%84%e8%bf%87%e6%bb%a4%e5%99%a8%e9%93%be" aria-label="Filter详解（执行流程、拦截路径、过滤器链）">Filter详解（执行流程、拦截路径、过滤器链）</a></li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e6%a0%a1%e9%aa%8cfilter" aria-label="登录校验——Filter">登录校验——Filter</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8b%a6%e6%88%aa%e5%99%a8interceptor" aria-label="拦截器Interceptor">拦截器Interceptor</a><ul>
                        
                <li>
                    <a href="#interceptor%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8" aria-label="Interceptor快速入门">Interceptor快速入门</a></li>
                <li>
                    <a href="#interceptor%e8%af%a6%e8%a7%a3%e6%8b%a6%e6%88%aa%e8%b7%af%e5%be%84%e6%89%a7%e8%a1%8c%e6%b5%81%e7%a8%8b" aria-label="Interceptor详解（拦截路径、执行流程）">Interceptor详解（拦截路径、执行流程）</a></li>
                <li>
                    <a href="#%e7%99%bb%e5%bd%95%e6%a0%a1%e9%aa%8cinterceptor" aria-label="登录校验——Interceptor">登录校验——Interceptor</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="登录功能">登录功能<a hidden class="anchor" aria-hidden="true" href="#登录功能">#</a></h2>
<h3 id="分析">分析<a hidden class="anchor" aria-hidden="true" href="#分析">#</a></h3>
<p>阅读<a href="https://www.steamedfish.top/post/java-web/javaweb-9-tlias-api-docs/#61-%E7%99%BB%E5%BD%95">接口文档——登录</a></p>
<p>了解需求之后分析三层架构各自的任务






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/1.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/1.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/1.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<h3 id="实体类">实体类<a hidden class="anchor" aria-hidden="true" href="#实体类">#</a></h3>
<ul>
<li><code>EmpLoginInfo.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.entity</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.AllArgsConstructor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.NoArgsConstructor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@NoArgsConstructor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EmpLoginInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<hr>
<h3 id="controller">Controller<a hidden class="anchor" aria-hidden="true" href="#controller">#</a></h3>
<ul>
<li><code>LoginController.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.controller</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.entity.Emp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.entity.EmpLoginInfo</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.entity.Result</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.service.EmpService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoginController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">EmpService</span><span class="w"> </span><span class="n">empService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 员工登录
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param emp
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@PostMapping</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Result</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">Emp</span><span class="w"> </span><span class="n">emp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;员工登录：{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">emp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">EmpLoginInfo</span><span class="w"> </span><span class="n">loginInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empService</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">emp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loginInfo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;用户名或密码错误！！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Result</span><span class="p">.</span><span class="na">success</span><span class="p">(</span><span class="n">loginInfo</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<hr>
<h3 id="service--mapper">Service &amp; Mapper<a hidden class="anchor" aria-hidden="true" href="#service--mapper">#</a></h3>
<ul>
<li><code>EmpServiceImpl.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 员工登录
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param emp
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">EmpLoginInfo</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">Emp</span><span class="w"> </span><span class="n">emp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//1.调用mapper方法查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Emp</span><span class="w"> </span><span class="n">empDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empMapper</span><span class="p">.</span><span class="na">selectByUsernameAndPassword</span><span class="p">(</span><span class="n">emp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//2.判断登录数据是否正确</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">empDB</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//3.查到数据构造EmpLoginInfo对象并返回</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//TODO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EmpLoginInfo</span><span class="p">(</span><span class="n">empDB</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">empDB</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> </span><span class="n">empDB</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//3.如果数据为空，代表登录失败，返回null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li><code>EmpMapper.xml</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--  登录--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;selectByUsernameAndPassword&#34;</span> <span class="na">resultType=</span><span class="s">&#34;com.javaweb.entity.Emp&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    select *
</span></span><span class="line"><span class="cl">    from emp
</span></span><span class="line"><span class="cl">    where username = #{username}
</span></span><span class="line"><span class="cl">      and password = #{password}
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/select&gt;</span>
</span></span></code></pre></div></li>
</ul>
<hr>
<h3 id="联调测试">联调测试<a hidden class="anchor" aria-hidden="true" href="#联调测试">#</a></h3>
<ul>
<li>问题：在未登录时，也能访问系统页面进行操作</li>
<li>解决方案：进行登录校验</li>
</ul>
<hr>
<h2 id="登录校验">登录校验<a hidden class="anchor" aria-hidden="true" href="#登录校验">#</a></h2>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/2.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/2.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/2.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<style type="text/css">
     
    .notice {
        --title-color: #fff;
        --title-background-color: #6be;
        --content-color: #444;
        --content-background-color: #e7f2fa;
    }

    .notice.info {
        --title-background-color: #fb7;
        --content-background-color: #fec;
    }

    .notice.tip {
        --title-background-color: #5a5;
        --content-background-color: #efe;
    }

    .notice.warning {
        --title-background-color: #c33;
        --content-background-color: #fee;
    }

     
    

    body.dark .notice {
        --title-color: #fff;
        --title-background-color: #069;
        --content-color: #ddd;
        --content-background-color: #023;
    }

    body.dark .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    body.dark .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    body.dark .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

     
    .notice {
        padding: 18px;
        line-height: 24px;
        margin-bottom: 24px;
        border-radius: 4px;
        color: var(--content-color);
        background: var(--content-background-color);
    }

    .notice p:last-child {
        margin-bottom: 0
    }

     
    .notice-title {
        margin: -18px -18px 12px;
        padding: 4px 18px;
        border-radius: 4px 4px 0 0;
        font-weight: 700;
        color: var(--title-color);
        background: var(--title-background-color);
    }

     
    .icon-notice {
        display: inline-flex;
        align-self: center;
        margin-right: 8px;
    }

    .icon-notice img,
    .icon-notice svg {
        height: 1em;
        width: 1em;
        fill: currentColor;
    }

    .icon-notice img,
    .icon-notice.baseline svg {
        top: .125em;
        position: relative;
    }
</style><div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></svg>
        </span>注释</p><ul>
<li>登录标记：用户登录成功之后，在后续的每一次请求中，都可以获取到该标记。【会话技术】</li>
<li>统一拦截：过滤器Filter、拦截器Interceptor</li>
</ul></div></p>
<hr>
<h3 id="会话技术">会话技术<a hidden class="anchor" aria-hidden="true" href="#会话技术">#</a></h3>
<ul>
<li>会话：用户打开浏览器，访问web服务器的资源，会话建立，直到有一方断开连接，会话结束。在一次会话中可以包含<strong>多次</strong>请求和响应。</li>
<li>会话跟踪：一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间<strong>共享数据</strong>。</li>
<li>会话跟踪方案：
<ul>
<li>客户端会话跟踪技术：Cookie






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/3.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/3.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/3.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<ul>
<li>优点：HTTP协议中支持的技术</li>
<li>缺点：
<ul>
<li>移动端APP无法使用Cookie</li>
<li>不安全，用户可以自己禁用Cookie</li>
<li>Cookie不能跨域






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/4.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/4.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/4.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></svg>
        </span>注释</p><p>跨域区分三个维度：协议、IP/域名、端口</p></div></li>
</ul>
</li>
</ul>
</li>
<li>服务端会话跟踪技术：Session






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/5.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/5.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/5.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<ul>
<li>优点：存储在服务端，安全</li>
<li>缺点：
<ul>
<li>服务器集群环境下无法直接使用session</li>
<li>Cookie的缺点</li>
</ul>
</li>
</ul>
</li>
<li>令牌技术






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/6.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/6.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/6.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>优点：
<ul>
<li>支持PC端、移动端</li>
<li>解决集群环境下的认证问题</li>
<li>减轻服务器端存储压力</li>
</ul>
</li>
<li>缺点：需要自己实现</li>
</ul>
</li>
</ul>
<hr>
<h3 id="jwt令牌">JWT令牌<a hidden class="anchor" aria-hidden="true" href="#jwt令牌">#</a></h3>
<h4 id="介绍">介绍<a hidden class="anchor" aria-hidden="true" href="#介绍">#</a></h4>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/7.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/7.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/7.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



全称：<strong>J</strong>SON <strong>W</strong>eb <strong>T</strong>oken (<a href="https://jwt.io/">https://jwt.io/</a>)<br>
定义了一种简洁的、自包含的格式，用于在通信双方以json数据格式安全的传输信息。<br>
组成：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/8.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/8.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/8.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ul>
<li>第一部分：<code>Header</code>（头），记录令牌类型、签名算法等。例如：<code>{&quot;alg&quot;:&quot;HS256&quot;，&quot;type&quot;:&quot;JwT&quot;}</code></li>
<li>第二部分：<code>Payload</code>（有效载荷），携带一些自定义信息、默认信息等。例如：<code>{&quot;id&quot;:&quot;1&quot;，&quot;username&quot;:&quot;Tom&quot;}</code></li>
<li>第三部分：<code>Signature</code>（签名），防止Token被篡改、确保安全性。将header、payload融入，并加入指定秘钥，通过指定签名算法计算而来。</li>
</ul>
<!-- FM:Snippet:Start data:{"id":"st-notice","fields":[]} -->
<div class="notice note" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/></svg>
        </span>注释</p><p><strong>Base64</strong>：是一种基于64个可打印字符（<code>A-Z</code> <code>a-Z</code> <code>0-9</code> <code>+</code> <code>/</code>）来表示二进制数据的编码方式</p></div>
<!-- FM:Snippet:End -->
<hr>
<h4 id="生成">生成<a hidden class="anchor" aria-hidden="true" href="#生成">#</a></h4>
<ol>
<li>导入依赖






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/9.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/9.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/9.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<ul>
<li><code>pox.xml</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--jwt令牌--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>jjwt<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>0.9.1<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>生成令牌






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/10.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/10.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/10.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<ul>
<li><code>src/test/java/com/javaweb/JWTTest.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.Jwts</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.SignatureAlgorithm</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.HashMap</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JWTTest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">version</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Jwts</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">getPackage</span><span class="p">().</span><span class="na">getImplementationVersion</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 测试生成JWT令牌
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testGenerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//自定义信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">claims</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">claims</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Tom&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//生成jwt令牌</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">signWith</span><span class="p">(</span><span class="n">SignatureAlgorithm</span><span class="p">.</span><span class="na">HS256</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;javaweb&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setClaims</span><span class="p">(</span><span class="n">claims</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setExpiration</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">3600</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">1000</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">compact</span><span class="p">();</span><span class="c1">//设置令牌有效期</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">jwt</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
</ol>
<ul>
<li>输出：
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNzY1MDU5NjIyLCJ1c2VybmFtZSI6IlRvbSJ9.xy0uLjUPprVYFJl0_dfixqMLMbnjoxAcirzF3ETfWq0
</span></span></code></pre></div></li>
</ul>
<div class="notice info" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
        </span>信息</p><p>这里的jjwta版本是0.9.1，在这个版本中我们可以使用&quot;javaweb&quot;这种弱密钥。<br>
但jjwt从0.10.x 开始校验 key 长度，强制要求 HS256 ≥ 256 bit（32 字节）</p></div>
<hr>
<h4 id="解析">解析<a hidden class="anchor" aria-hidden="true" href="#解析">#</a></h4>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/11.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/11.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/11.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ul>
<li><code>JWTTest.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 测试解析JWT令牌
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testParseJwt</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Claims</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">parser</span><span class="p">().</span><span class="na">setSigningKey</span><span class="p">(</span><span class="s">&#34;javaweb&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">parseClaimsJws</span><span class="p">(</span><span class="s">&#34;eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNzY1MDU5NjIyLCJ1c2VybmFtZSI6IlRvbSJ9.xy0uLjUPprVYFJl0_dfixqMLMbnjoxAcirzF3ETfWq0&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">getBody</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">claims</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>输出：
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">{id=1, exp=1765059622, username=Tom}
</span></span></code></pre></div></li>
</ul>
<hr>
<h3 id="登录生成令牌">登录——生成令牌<a hidden class="anchor" aria-hidden="true" href="#登录生成令牌">#</a></h3>
<ol>
<li>引入JWT令牌操作工具类
<ul>
<li><code>src/main/java/com/javaweb/utils/JWTUtils.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.utils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.Claims</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.Jwts</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.SignatureAlgorithm</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Date</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.util.Map</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JWTUtils</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//自定义密钥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;SVRIRUlNQQ&#34;</span><span class="p">;</span><span class="c1">//密钥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//过期时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">expire</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">43200000L</span><span class="p">;</span><span class="c1">//12h</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 生成JWT令牌
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param claims
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">generateJwt</span><span class="p">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">claims</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">addClaims</span><span class="p">(</span><span class="n">claims</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">signWith</span><span class="p">(</span><span class="n">SignatureAlgorithm</span><span class="p">.</span><span class="na">HS256</span><span class="p">,</span><span class="w"> </span><span class="n">secret</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setExpiration</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">expire</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">compact</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">jwt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 解析JWT令牌
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param jwt Jwt令牌
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return JWT第二部分负载 payload 中的内容
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Claims</span><span class="w"> </span><span class="nf">parseJwt</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">jwt</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Claims</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Jwts</span><span class="p">.</span><span class="na">parser</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">setSigningKey</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">parseClaimsJws</span><span class="p">(</span><span class="n">jwt</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">.</span><span class="na">getBody</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">claims</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>登录完成后，调用工具类生成JWT令牌，并返回
<ul>
<li><code>EmpServiceImpl.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">* 员工登录
</span></span></span><span class="line"><span class="cl"><span class="cm">*
</span></span></span><span class="line"><span class="cl"><span class="cm">* @param emp
</span></span></span><span class="line"><span class="cl"><span class="cm">* @return
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">EmpLoginInfo</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">Emp</span><span class="w"> </span><span class="n">emp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="c1">//1.调用mapper方法查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">Emp</span><span class="w"> </span><span class="n">empDB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empMapper</span><span class="p">.</span><span class="na">selectByUsernameAndPassword</span><span class="p">(</span><span class="n">emp</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="c1">//2.判断登录数据是否正确</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">empDB</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">//3.查到数据构造EmpLoginInfo对象并返回</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">//完善登录逻辑，登录成功生成JWT令牌</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">//自定义载荷</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">claims</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">,</span><span class="n">empDB</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">claims</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="n">empDB</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">String</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JWTUtils</span><span class="p">.</span><span class="na">generateJwt</span><span class="p">(</span><span class="n">claims</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EmpLoginInfo</span><span class="p">(</span><span class="n">empDB</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">empDB</span><span class="p">.</span><span class="na">getUsername</span><span class="p">(),</span><span class="w"> </span><span class="n">empDB</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">jwt</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="c1">//3.如果数据为空，代表登录失败，返回null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
</ol>
<h3 id="过滤器filter">过滤器Filter<a hidden class="anchor" aria-hidden="true" href="#过滤器filter">#</a></h3>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/12.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/12.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/12.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ul>
<li>概念：<strong>Filter 过滤器</strong>，是JavaWeb三大组件(Servlet、Filter、Listener)之一。</li>
<li>过滤器可以把对资源的请求<strong>拦截</strong>下来，从而实现一些特殊的功能。</li>
<li>过滤器一般完成一些<strong>通用</strong>的操作，比如：登录校验、统一编码处理、敏感字符处理等。</li>
</ul>
<h4 id="filter快速入门">Filter快速入门<a hidden class="anchor" aria-hidden="true" href="#filter快速入门">#</a></h4>
<ol>
<li>定义Filter：定义一个类，实现 Filter 接口，并重写其所有方法。</li>
<li>配置Filter：Filter类上加<code>@WebFilter</code>注解，配置拦截路径。引导类上加<code>@ServletComponentScan</code> 开启Servlet组件支持。






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/13.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/13.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/13.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ol>
<hr>
<p>示例：</p>
<ul>
<li><code>src/main/java/com/javaweb/filter/DemoFilter.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.filter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.annotation.WebFilter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//@WebFilter(urlPatterns = &#34;/*&#34;)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//@WebFilter(value = &#34;/*&#34;)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@WebFilter</span><span class="p">(</span><span class="s">&#34;/*&#34;</span><span class="p">)</span><span class="w">    </span><span class="c1">//设置拦截路径/*，代表拦截所有请求</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DemoFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="c1">//初始化方法，在web服务器启动时触发一次</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">FilterConfig</span><span class="w"> </span><span class="n">filterConfig</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoFilter...init...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="c1">//销毁方法，在web服务器正常关闭时触发一次</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoFilter...doFilter...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="c1">//放行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">destroy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoFilter...destroy...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li><code>TliasManagementApplication.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.web.servlet.ServletComponentScan</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 启动类
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@ServletComponentScan</span><span class="w">   </span><span class="c1">//开启sevlet组件扫描</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TliasManagementApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">TliasManagementApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;项目启动成功...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<hr>
<h4 id="filter详解执行流程拦截路径过滤器链">Filter详解（执行流程、拦截路径、过滤器链）<a hidden class="anchor" aria-hidden="true" href="#filter详解执行流程拦截路径过滤器链">#</a></h4>
<ul>
<li>
<p>执行流程<br>






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/14.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/14.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/14.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/15.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/15.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/15.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



放行后访问对应资源，资源访问完成后，会回到Filter中<br>
回到Filter中后，会执行放行后的逻辑</p>
</li>
<li>
<p>拦截路径<br>
Filter可以根据需求，配置不同的拦截资源路径：</p>




<table>

    <thead>
      <tr>
          <th style="text-align: center">拦截路径</th>
          <th style="text-align: center"><code>urlPatterns</code>值</th>
          <th style="text-align: center">含义</th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">拦截具体路径</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/login</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">只有访问/login路径时，才会被拦截</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">目录拦截</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/emps/*</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">访问/emps下的所有资源，都会被拦截</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">拦截所有</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/*</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">访问所有资源，都会被拦截</td>
      </tr>
  </tbody>
</table></li>
<li>
<p>过滤器链<br>






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/16.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/16.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/16.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



介绍：一个web应用中，可以配置多个过滤器，这多个过滤器就形成了一个<strong>过滤器链</strong>。<br>
顺序：注解配置的Filter，优先级是按照过滤器类名（字符串）的自然排序。</p>
</li>
</ul>
<hr>
<h4 id="登录校验filter">登录校验——Filter<a hidden class="anchor" aria-hidden="true" href="#登录校验filter">#</a></h4>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/17.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/17.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/17.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ul>
<li>流程：</li>
</ul>
<ol>
<li>获取请求url。</li>
<li>判断请求url中是否包含login，如果包含，说明是登录操作，放行。</li>
<li>获取请求头中的令牌（token）。</li>
<li>判断令牌是否存在，如果不存在，响应401。</li>
<li>解析token，如果解析失败，响应401。</li>
<li>放行。</li>
</ol>
<ul>
<li><code>src/main/java/com/javaweb/filter/LoginCheckFilter.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.filter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.utils.JWTUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.Claims</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.annotation.WebFilter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletRequest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletResponse</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@WebFilter</span><span class="p">(</span><span class="s">&#34;/*&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoginCheckFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//0.强转对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpServletResponse</span><span class="p">)</span><span class="w"> </span><span class="n">response</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        1. 获取请求url。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        2. 判断请求url中是否包含login，如果包含，说明是登录操作，放行。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="s">&#34;login&#34;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//放行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//【注意】：一定要结束当前请求</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        3. 获取请求头中的令牌（token）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;token&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        4. 判断令牌是否存在，如果不存在，响应401。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">401</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;令牌为空&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//            throw new BusinessException(&#34;未登录，请先登录&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        5. 解析token，如果解析失败，响应401。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Claims</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JWTUtils</span><span class="p">.</span><span class="na">parseJwt</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;token:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;claims：{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">claims</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">401</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;令牌解析失败:{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//            throw new BusinessException(&#34;未登录，请先登录&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        6. 放行。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
<h3 id="拦截器interceptor">拦截器Interceptor<a hidden class="anchor" aria-hidden="true" href="#拦截器interceptor">#</a></h3>
<ul>
<li>概念：是一种动态拦截方法调用的机制，类似于过滤器。Spring框架中提供的，主要用来动态拦截控制器方法的执行。</li>
<li>作用：拦截请求，在指定的方法调用前后，根据业务需要执行预先设定的代码。</li>
</ul>
<hr>
<h4 id="interceptor快速入门">Interceptor快速入门<a hidden class="anchor" aria-hidden="true" href="#interceptor快速入门">#</a></h4>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/18.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/18.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/18.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ol>
<li>定义拦截器，实现HanderInterceptor接口，并重写其所有方法。
<ul>
<li><code>src/main/java/com/javaweb/interceptor/DemoInterceptor.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.interceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletRequest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletResponse</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Component</span><span class="c1">//交给spring管理</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DemoInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">HandlerInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//目标方法执行前触发 --返回true放行，返回false，代表拦截，不执行目标方法</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">preHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoInterceptor...preHandle...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//目标方法执行后触发</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">postHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="n">ModelAndView</span><span class="w"> </span><span class="n">modelAndView</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoInterceptor...postHandle...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//最后执行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterCompletion</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;DemoInterceptor...afterCompletion...&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>注册拦截器
<ul>
<li><code>src/main/java/com/javaweb/WebConfig.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.interceptor.DemoInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 配置类
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//@Component//将类注入到Spring容器中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="c1">//声明当前类是一个配置类 等价于 @Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DemoInterceptor</span><span class="w"> </span><span class="n">demoInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//注册拦截器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;注册拦截器&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">demoInterceptor</span><span class="p">).</span><span class="na">addPathPatterns</span><span class="p">(</span><span class="s">&#34;/**&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
</ol>
<hr>
<h4 id="interceptor详解拦截路径执行流程">Interceptor详解（拦截路径、执行流程）<a hidden class="anchor" aria-hidden="true" href="#interceptor详解拦截路径执行流程">#</a></h4>
<ul>
<li>拦截路径<br>
拦截器可以根据需求，配置不同的拦截路径：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/19.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/19.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/19.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>







<table>

    <thead>
      <tr>
          <th style="text-align: center">拦截路径</th>
          <th style="text-align: center">含义</th>
          <th style="text-align: center">举例</th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/*</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">一级路径</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">能匹配<code>/depts</code>，<code>/emps</code>，<code>/login</code>，不能匹配<code>/depts/1</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/**</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">任意级路径</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">能匹配<code>/depts</code>，<code>/depts/1</code>，<code>/depts/1/2</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/depts/*</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/depts</code>下的一级路径</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">能匹配<code>/depts/1</code>，不能匹配<code>/depts/1/2</code>，<code>/depts</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/depts/**</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>/depts</code>下的任意级路径</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">能匹配<code>/depts</code>，<code>/depts/1</code>，<code>/depts/1/2</code>，不能匹配<code>/emps/1</code></td>
      </tr>
  </tbody>
</table></li>
<li>执行流程






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/java-web/javaweb-20-springboot-tlias9/index.md"
    href="/post/java-web/javaweb-20-springboot-tlias9/20.webp"
    data-caption=""
  >
    <img
      src="/post/java-web/javaweb-20-springboot-tlias9/20.webp"
      srcset="/post/java-web/javaweb-20-springboot-tlias9/20.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<ul>
<li>Filter和Interceptor的区别：
<ol>
<li>接口规范不同：过滤器需要实现Filter接口，而拦截器需要实现HandlerInterceptor接口。</li>
<li>拦截范围不同：过滤器Filter会拦截所有的资源，而Interceptor只会拦截Spring环境中的资源。</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="登录校验interceptor">登录校验——Interceptor<a hidden class="anchor" aria-hidden="true" href="#登录校验interceptor">#</a></h4>
<ul>
<li><code>LoginCheckInterceptor.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb.interceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.utils.JWTUtils</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">io.jsonwebtoken.Claims</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletRequest</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletResponse</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Component</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 登录校验拦截器
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LoginCheckInterceptor</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">HandlerInterceptor</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">preHandle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        1. 获取请求url。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;uri = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">////        2. 判断请求url中是否包含login，如果包含，说明是登录操作，放行。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        if (uri.contains(&#34;login&#34;)) {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//            return true;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        }</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        3. 获取请求头中的令牌（token）。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;token&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        4. 判断令牌是否存在，如果不存在，响应401。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&#34;令牌不存在&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNAUTHORIZED</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//不放行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        5. 解析token，如果解析失败|，响应401。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Claims</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JWTUtils</span><span class="p">.</span><span class="na">parseJwt</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;claims = {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">claims</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;令牌解析失败: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//            e.printStackTrace();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">response</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">UNAUTHORIZED</span><span class="p">.</span><span class="na">value</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//不放行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        6. 放行。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li><code>WebConfig.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.javaweb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.interceptor.DemoInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.javaweb.interceptor.LoginCheckInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.extern.slf4j.Slf4j</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 配置类
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//@Component//将类注入到Spring容器中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span><span class="c1">//声明当前类是一个配置类 等价于 @Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebMvcConfigurer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DemoInterceptor</span><span class="w"> </span><span class="n">demoInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LoginCheckInterceptor</span><span class="w"> </span><span class="n">loginCheckInterceptor</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//注册拦截器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addInterceptors</span><span class="p">(</span><span class="n">InterceptorRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;注册拦截器&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//        registry.addInterceptor(demoInterceptor).addPathPatterns(&#34;/**&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//如果没有写拦截路径，则所有请求都会被拦截</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addInterceptor</span><span class="p">(</span><span class="n">loginCheckInterceptor</span><span class="p">).</span><span class="na">excludePathPatterns</span><span class="p">(</span><span class="s">&#34;/login&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.steamedfish.top/tags/filter/">Filter</a></li>
      <li><a href="https://www.steamedfish.top/tags/interceptor/">Interceptor</a></li>
      <li><a href="https://www.steamedfish.top/tags/jwt%E4%BB%A4%E7%89%8C/">JWT令牌</a></li>
      <li><a href="https://www.steamedfish.top/tags/springboot%E6%A1%86%E6%9E%B6/">SpringBoot框架</a></li>
      <li><a href="https://www.steamedfish.top/tags/%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF/">会话技术</a></li>
      <li><a href="https://www.steamedfish.top/tags/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a></li>
      <li><a href="https://www.steamedfish.top/tags/%E6%8B%A6%E6%88%AA%E5%99%A8/">拦截器</a></li>
      <li><a href="https://www.steamedfish.top/tags/%E8%BF%87%E6%BB%A4%E5%99%A8/">过滤器</a></li>
      <li><a href="https://www.steamedfish.top/tags/%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C/">登录校验</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://www.steamedfish.top/">©2025 SteamedFish&rsquo;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<script src="https://unpkg.com/@barba/core"></script>







<link href="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
<script src="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/meting/2.0.2/Meting.min.js"></script>
<script src="/js/player.js"></script>
<script src="/js/pjax.js"></script>




<link
  rel="stylesheet"
  href="/lib/fancybox/fancybox.css"
/>
<script src="/lib/fancybox/fancybox.umd.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    Fancybox.bind("[data-fancybox]", {
      animated: true,                  
      showClass: 'fancybox-fadeIn',    
      hideClass: 'fancybox-fadeOut',   
      dragToClose: true                 
    });
  });
</script>






<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
