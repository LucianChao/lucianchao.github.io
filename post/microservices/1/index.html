<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Mybatis Plus | SteamedFish&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="介绍
MybatisPlus（简称 MP）是一个 Mybatis 的增强工具 ，在Mybatis的基础上只做增强不做改变，为简化开发、提高效率而生。






    


       
    




  
    
  
    
  





快速入门
入门案例
需求：基于资料提供的项目，实现下列功能：

新增用户功能
根据id查询用户
根据id批量查询用户
根据id更新用户
根据id删除用户


步骤

运行src/test/java/com/itheima/mp/mapper/UserMapperTest.java下的testQueryByIds测试方法，查看环境是否正常






    


       
    




  
    
  
    
  




引入MybatisPlus的起步依赖
MyBatisPlus官方提供了starter，其中集成了Mybatis和MybatisPlus的所有功能，并且实现了自动装配效果。
因此我们可以用MybatisPlus的starter代替Mybatis的starter：






    


       
    




  
    
  
    
  










    


       
    




  
    
  
    
  




定义Mapper
自定义的Mapper继承MybatisPlus提供的BaseMapper接口：






    


       
    




  
    
  
    
  




改造Mapper
继承之后删掉Mapper中原本的代码






    


       
    




  
    
  
    
  










    


       
    




  
    
  
    
  




修改测试方法，使用Mybatis-plus的方法，查看能否进行增删改查


常见注解
MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。">
<meta name="author" content="">
<link rel="canonical" href="https://www.steamedfish.top/post/microservices/1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.c27e1246cb66d388c2c28ba2cad7d8e45b296bdd6da67c05cf15ef27e74594b2.css" integrity="sha256-wn4SRstm04jCwouiytfY5Fspa91tpnwFzxXvJ&#43;dFlLI=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://www.steamedfish.top/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.steamedfish.top/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.steamedfish.top/favicon.png">
<link rel="apple-touch-icon" href="https://www.steamedfish.top/favicon.png">
<link rel="mask-icon" href="https://www.steamedfish.top/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://www.steamedfish.top/post/microservices/1/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>





<link
  href="/fonts/lxgw/style.css"
  rel="stylesheet"
/><meta property="og:url" content="https://www.steamedfish.top/post/microservices/1/">
  <meta property="og:site_name" content="SteamedFish&#39;s Blog">
  <meta property="og:title" content="Mybatis Plus">
  <meta property="og:description" content="介绍 MybatisPlus（简称 MP）是一个 Mybatis 的增强工具 ，在Mybatis的基础上只做增强不做改变，为简化开发、提高效率而生。 快速入门 入门案例 需求：基于资料提供的项目，实现下列功能：
新增用户功能 根据id查询用户 根据id批量查询用户 根据id更新用户 根据id删除用户 步骤 运行src/test/java/com/itheima/mp/mapper/UserMapperTest.java下的testQueryByIds测试方法，查看环境是否正常 引入MybatisPlus的起步依赖
MyBatisPlus官方提供了starter，其中集成了Mybatis和MybatisPlus的所有功能，并且实现了自动装配效果。
因此我们可以用MybatisPlus的starter代替Mybatis的starter： 定义Mapper
自定义的Mapper继承MybatisPlus提供的BaseMapper接口： 改造Mapper
继承之后删掉Mapper中原本的代码 修改测试方法，使用Mybatis-plus的方法，查看能否进行增删改查 常见注解 MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-12-30T16:21:57+08:00">
    <meta property="article:modified_time" content="2026-01-01T19:56:53+08:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mybatis Plus">
<meta name="twitter:description" content="介绍
MybatisPlus（简称 MP）是一个 Mybatis 的增强工具 ，在Mybatis的基础上只做增强不做改变，为简化开发、提高效率而生。






    


       
    




  
    
  
    
  





快速入门
入门案例
需求：基于资料提供的项目，实现下列功能：

新增用户功能
根据id查询用户
根据id批量查询用户
根据id更新用户
根据id删除用户


步骤

运行src/test/java/com/itheima/mp/mapper/UserMapperTest.java下的testQueryByIds测试方法，查看环境是否正常






    


       
    




  
    
  
    
  




引入MybatisPlus的起步依赖
MyBatisPlus官方提供了starter，其中集成了Mybatis和MybatisPlus的所有功能，并且实现了自动装配效果。
因此我们可以用MybatisPlus的starter代替Mybatis的starter：






    


       
    




  
    
  
    
  










    


       
    




  
    
  
    
  




定义Mapper
自定义的Mapper继承MybatisPlus提供的BaseMapper接口：






    


       
    




  
    
  
    
  




改造Mapper
继承之后删掉Mapper中原本的代码






    


       
    




  
    
  
    
  










    


       
    




  
    
  
    
  




修改测试方法，使用Mybatis-plus的方法，查看能否进行增删改查


常见注解
MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://www.steamedfish.top/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Mybatis Plus",
      "item": "https://www.steamedfish.top/post/microservices/1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Mybatis Plus",
  "name": "Mybatis Plus",
  "description": "介绍 MybatisPlus（简称 MP）是一个 Mybatis 的增强工具 ，在Mybatis的基础上只做增强不做改变，为简化开发、提高效率而生。 快速入门 入门案例 需求：基于资料提供的项目，实现下列功能：\n新增用户功能 根据id查询用户 根据id批量查询用户 根据id更新用户 根据id删除用户 步骤 运行src/test/java/com/itheima/mp/mapper/UserMapperTest.java下的testQueryByIds测试方法，查看环境是否正常 引入MybatisPlus的起步依赖\nMyBatisPlus官方提供了starter，其中集成了Mybatis和MybatisPlus的所有功能，并且实现了自动装配效果。\n因此我们可以用MybatisPlus的starter代替Mybatis的starter： 定义Mapper\n自定义的Mapper继承MybatisPlus提供的BaseMapper接口： 改造Mapper\n继承之后删掉Mapper中原本的代码 修改测试方法，使用Mybatis-plus的方法，查看能否进行增删改查 常见注解 MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。\n",
  "keywords": [
    
  ],
  "articleBody": "介绍 MybatisPlus（简称 MP）是一个 Mybatis 的增强工具 ，在Mybatis的基础上只做增强不做改变，为简化开发、提高效率而生。 快速入门 入门案例 需求：基于资料提供的项目，实现下列功能：\n新增用户功能 根据id查询用户 根据id批量查询用户 根据id更新用户 根据id删除用户 步骤 运行src/test/java/com/itheima/mp/mapper/UserMapperTest.java下的testQueryByIds测试方法，查看环境是否正常 引入MybatisPlus的起步依赖\nMyBatisPlus官方提供了starter，其中集成了Mybatis和MybatisPlus的所有功能，并且实现了自动装配效果。\n因此我们可以用MybatisPlus的starter代替Mybatis的starter： 定义Mapper\n自定义的Mapper继承MybatisPlus提供的BaseMapper接口： 改造Mapper\n继承之后删掉Mapper中原本的代码 修改测试方法，使用Mybatis-plus的方法，查看能否进行增删改查 常见注解 MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。\n类名驼峰转下划线作为表名 名为id的字段作为主键 变量名驼峰转下划线作为表的字段名 MybatisPlus中比较常用的几个注解如下： @TableName：用来指定表名 @TableId：用来指定表中的主键字段信息 IdType枚举： AUTO：数据库自增长 INPUT：通过set方法自行输入 ASSIGN_ID：分配 ID，接口IdentifierGenerator的方法nextId来生成id，默认实现类为DefaultIdentifierGenerator雪花算法 @TableField：用来指定表中的普通字段信息 使用@TableField的常见场景： 成员变量名与数据库字段名不一致 成员变量名以is开头，且是布尔值 成员变量名与数据库关键字冲突 成员变量不是数据库字段 常见配置 MyBatisPlus的配置项继承了MyBatis原生配置和一些自己特有的配置。例如： 具体可参考官方文档：使用配置 | MyBatis-Plus\n核心功能 条件构造器 MyBatisPlus支持各种复杂的where条件，可以满足日常开发的所有需求。 基于QueryWrapper的查询 需求：\n查询出名字中带o的，存款大于等于1000元的人的id、username、info、balance字段 @Test public void testQueryWrapper() { //条件构造器 QueryWrapper\u003cUser\u003e queryWrapper = new QueryWrapper\u003c\u003e(); //查询的列 queryWrapper.select(\"id\", \"username\", \"info\", \"balance\"); //查询条件： 名字带`o` queryWrapper.like(\"username\", \"o\"); //查询条件： 存款大于等于1000 queryWrapper.ge(\"balance\", 1000); //查询 List\u003cUser\u003e userList = userMapper.selectList(queryWrapper); //输出 //userList.forEach(System.out::println); for (User user : userList) { System.out.println(user); } } @Test public void testLambdaQueryWrapper() { LambdaQueryWrapper\u003cUser\u003e lambdaQueryWrapper = new LambdaQueryWrapper\u003c\u003e(); lambdaQueryWrapper.select(User::getId,User::getUsername,User::getInfo,User::getBalance); lambdaQueryWrapper.like(User::getUsername, \"o\"); lambdaQueryWrapper.ge(User::getBalance, 1000); List\u003cUser\u003e userList = userMapper.selectList(lambdaQueryWrapper); for (User user : userList) { System.out.println(user); } } 提示\n尽量使用LambdaQueryWrapper和LambdaUpdateWrapper，避免硬编码 QueryWrapper和LambdaQueryWrapper通常用来构建select、delete、update的where条件部分 UpdateWrapper和LambdaUpdateWrapper通常只有在set语句比较特殊才使用 更新用户名为jack的用户的余额为2000 @Test public void testQueryWrapperUpdate() { User user = new User(); user.setBalance(2000); QueryWrapper\u003cUser\u003e queryWrapper = new QueryWrapper\u003c\u003e(); queryWrapper.eq(\"username\", \"jack\"); int updated = userMapper.update(user, queryWrapper); } 基于UpdateWrapper的更新 需求：更新id为1,2,4的用户的余额，扣200 // update user set balance = balance - 200 where id in (1, 2, 4); @Test void testUpdateWrapper() { UpdateWrapper\u003cUser\u003e updateWrapper = new UpdateWrapper\u003c\u003e(); //自定义更新语句，设置的是set updateWrapper.setSql(\"balance = balance - 200\"); //id为1，2，4的用户 -- where id in (1,2,4) updateWrapper.in(\"id\", 1, 2, 4); userMapper.update(null, updateWrapper); } 自定义SQL 我们可以利用yBatisPlus的Wrapper来构建复杂的Where条件，然后自己定义SQL语句中剩下的部分。 基于Wrapper构建where条件 在mapper方法参数中用Param注解声明wrapper变量名称，必须是ew 自定义SQL，并使用Wrapper条件 基于Wrapper的多表关联查询 需求：查询出所有收货地址在北京的并且用户id在指定范围的用户（例如1、2、4 ）的用户 Service接口 使用流程 自定义Service接口继承IService接口 自定义Service实现类，实现自定义接口并继承ServiceImpl类 基于Restful风格实现下列接口 需求：基于Restful风格实现下面的接口： 分析：1,2,3,4是常见的基本接口，可以直接在controller中调用mybatisPlus的service接口提供的方法实现；不需要再写任何业务方法\n5这个接口有特别的业务逻辑（判断用户正常（不为2）、余额充足才能做扣减），需要在Service中新增方法来实现\n要编写具体的接口，实现web功能；需要引入spring-boot-starter-web；\n另外为了方便测试可以引入knife4j的依赖；通过访问界面来测试所写的接口。\n因此我们可以添加如下依赖： 要能够被swagger可访问测试接口的话，在处理编写时可以设置对应注解，示例如下： 新增业务方法 特殊的业务方法，mybatisPlus中没有提供的，则可以自定义编写 IService的Lambda查询 需求：实现一个根据复杂条件查询用户的接口，查询条件如下：\nname：用户名关键字，可以为空 status：用户状态，可以为空 minBalance：最小余额，可以为空 maxBalance：最大余额，可以为空 @Operation(summary = \"根据条件查询用户列表\") @PostMapping(\"/list\") public List\u003cUserVO\u003e queryList(@RequestBody UserQuery userQuery) { String username = userQuery.getName(); Integer status = userQuery.getStatus(); Integer minBalance = userQuery.getMinBalance(); Integer maxBalance = userQuery.getMaxBalance(); QueryWrapper\u003cUser\u003e queryWrapper = new QueryWrapper\u003c\u003e(); // if (StrUtil.isNotBlank(username)){ // queryWrapper.lambda().like(User::getUsername,username); // } // v2.0 // 条件成立就把条件添加到where中 // queryWrapper.lambda().like(StrUtil.isNotBlank(username), User::getUsername, username) // .eq(status != null, User::getStatus, status) // .ge(minBalance != null, User::getBalance, minBalance) // .le(maxBalance != null, User::getBalance, maxBalance); // List list = userService.list(queryWrapper); // v3.0 List\u003cUser\u003e userList = userService.lambdaQuery() .like(StrUtil.isNotBlank(username), User::getUsername, username) .eq(status != null, User::getStatus, status) .ge(minBalance != null, User::getBalance, minBalance) .le(maxBalance != null, User::getBalance, maxBalance) .list(); //最终进行查询 return BeanUtil.copyToList(list, UserVO.class); } 信息\n这种代码并不规范，超出了Controller的职责范围，Controller应该只负责接收请求和调用接口，具体的业务逻辑应该在service层中实现\nIService的Lambda更新 需求：改造根据id修改用户余额的接口，要求如下：\n完成对用户状态校验 完成对用户余额校验 如果扣减后余额为0，则将用户status修改为冻结状态（2） @Override public void deductionBalanceById(Long id, int amount) { // 1.判断用户是否正常（账户状态） User user = getById(id); if (user == null || user.getStatus() == 2) { throw new RuntimeException(\"用户状态异常或者用户不存在\"); } // 2.判断余额是否充足，当前账户余额 - 扣减金额 \u003e 0 if (user.getBalance() \u003c amount) { throw new RuntimeException(\"余额不足\"); } // 3.扣减金额 // 获取扣减之后的余额 int remainBalance = user.getBalance() - amount; // userMapper.updateBalanceById(id, amount); // update user set balance = ? ,status = 2 where id = ? // update user set balance = ? where id = ? this.lambdaUpdate() .set(User::getBalance,remainBalance) //设置余额 .set(remainBalance == 0,User::getStatus,2) //账户余额为0，账户状态改为2 .eq(User::getId,id) //设置id .update(); } 需求：批量插入10万条用户数据，并作出对比： 普通for循环插入 耗时：609121毫秒（≈6分钟）\rIService的批量插入 耗时：25922毫秒（≈25秒）\r开启rewriteBatchedStatements=true参数，再次执行saveBatch() 耗时：9860毫秒（≈10秒\r结论：\n批处理方案： 普通for循环逐条插入速度极差，不推荐 MP的批量新增，基于预编译的批处理，性能不错 配置jdbc参数，开rewriteBatchedStatements，性能最好 拓展功能 代码生成 静态工具 需求：\n改造根据id查询用户的接口，查询用户的同时，查询出用户对应的所有地址 @Override public UserVO queryUserAndAddressesById(Long id) { // 1.查询用户信息 User user = getById(id); UserVO userVO = BeanUtil.copyProperties(user, UserVO.class); // 2.根据用户id查询其对应的用户地址列表，然后转换为vo列表，设置进userVO中 List\u003cAddress\u003e addressList = Db.lambdaQuery(Address.class) .eq(Address::getUserId, id) .list(); List\u003cAddressVO\u003e addressVOS = BeanUtil.copyToList(addressList, AddressVO.class); userVO.setAddresses(addressVOS); return userVO; } 改造根据id批量查询用户的接口，查询用户的同时，查询出用户对应的所有地址 @Override public List\u003cUserVO\u003e queryUserAndAddressesByIds(List\u003cLong\u003e ids) { // 1.根据id查询用户列表 List\u003cUser\u003e userList = listByIds(ids); List\u003cUserVO\u003e userVOList = BeanUtil.copyToList(userList, UserVO.class); // 2.根据id查询用户对应的地址列表 List\u003cAddress\u003e addressList = Db.lambdaQuery(Address.class) .in(Address::getUserId, ids) .list(); List\u003cAddressVO\u003e addressVOS = BeanUtil.copyToList(addressList, AddressVO.class); // 将地址列表集合转换为：map\u003c用户id,地址列表\u003e Map\u003cLong, List\u003cAddressVO\u003e\u003e userAddressMap = addressVOS.stream().collect(Collectors.groupingBy(AddressVO::getUserId)); // 就可以循环用户列表，根据用户id从map中获取对应的地址列表 for (UserVO userVO : userVOList) { List\u003cAddressVO\u003e addressVOList = userAddressMap.get(userVO.getId()); userVO.setAddresses(addressVOList); } return userVOList; } 实现根据用户id查询收货地址功能，需要验证用户状态，冻结用户抛出异常（练习） @Override public List\u003cAddressVO\u003e queryAddressesById(Long id) { User user = getById(id); if (user == null || user.getStatus() == UserStatus.FROZEN) { throw new RuntimeException(\"用户状态异常或者用户不存在\"); } List\u003cAddress\u003e addressList = Db.lambdaQuery(Address.class) .eq(Address::getUserId, id) .list(); return BeanUtil.copyToList(addressList, AddressVO.class); } 逻辑删除 逻辑删除就是基于代码逻辑模拟删除效果，但并不会真正删除数据。思路如下：\n在表中添加一个字段标记数据是否被删除 当删除数据时把标记置为1 查询时只查询标记为0的数据 例如逻辑删除字段为deleted： 删除操作： 查询操作： MybatisPlus提供了逻辑删除功能，无需改变方法调用的方式，而是在底层帮我们自动修改CRUD的语句。我们要做的就是在application.yaml文件中配置逻辑删除的字段名称和值即可： 枚举处理 步骤：\n在application.yml中配置全局枚举处理器 创建枚举类与修改属性类型 /enums/UserStatus.java package com.itheima.mp.enums; import com.baomidou.mybatisplus.annotation.EnumValue; import com.fasterxml.jackson.annotation.JsonValue; import lombok.Getter; @Getter public enum UserStatus { NORMAL(1, \"正常\"), FROZEN(2, \"冻结\"); // 保存到数据库中的值 @EnumValue private final Integer code; // 在序列化时候，使用的值 @JsonValue private final String message; UserStatus(Integer code, String message) { this.code = code; this.message = message; } } User属性类型修改（UserVO也要修改）\r测试：访问根据id查询用户接口 JSON处理器 步骤：\n创建UserInfo类 /domain/po/UserInfo.java package com.itheima.mp.domain.po; import lombok.Data; @Data public class UserInfo { // 简介 private String intro; // 年龄 private Integer age; // 性别 private String gender; } 修改User及UserVO User\rUser\rUserInfo\r测试：访问根据id查询用户接口 配置加密 MyBatisPlus从3.3.2版本开始提供了一个基于AES算法的加密工具，帮助我们对配置中的敏感信息做加密处理。 在application.yaml文件中使用刚刚生成的秘钥，代替明文的用户名和密码 在项目启动的时候，添加AES的秘钥，这样MyBatisPlus就可以解密数据了： 单元测试时，可以通过@SpringBootTest来指定秘钥： Idea中则可以通过Program arguments来配置： 插件功能 MyBatisPlus基于MyBatis的Interceptor实现了一个基础拦截器，并在内部保存了MyBatisPlus的内置拦截器的集合： MyBatisPlus提供的内置拦截器有下面这些：\n序号\r拦截器\r描述\r1\rTenantLineInnerInterceptor\r多租户插件\r2\rDynamicTableNameInnerInterceptor\r动态表名插件\r3\rPaginationInnerInterceptor\r分页插件\r4\rOptimisticLockerInnerInterceptor\r乐观锁插件\r5\rIllegalsQLInnerInterceptor\rSQL性能规范插件，检测并拦截垃圾SQL\r6\rBlockAttackInnerInterceptor\r防止全表更新和删除的插件\r分页插件 首先，要在配置类中注册MyBatisPlus的核心插件，同时添加分页插件.就可以在mapper或者service中带有page字段或者参数为pager的方法中使用了：\n在3.5.9版本之后，MyBatis Plus 对组件做了拆分，比如分页功能依赖的 jsqlparser 被单独拆成了 mybatis-plus-jsqlparser 包。需要手动添加依赖，否则 PaginationInnerInterceptor 会找不到所需的解析工具。 com.baomidou mybatis-plus-jsqlparser 3.5.15 接着，就可以使用分页的API了 简单分页查询案例 需求：遵循下面的接口规范，编写一个UserController接口，实现User的分页查询 返回值： 通用分页实体 需求： 在PageQuery中定义方法，将PageQuery对象转为MyBatisPlus中的Page对象 在PageDTO中定义方法，将MyBatisPlus中的Page结果转为PageDTO结果\n项目实战 黑马商城-用户登录 需求：需要实现用户输入用户名和密码的登录功能：\n校验用户名是否存在 用户的状态是否被冻结，冻结则不能登录 校验用户的密码是否正确 都正确的情况下，根据用户id生成token令牌 返回UserLoginVO并设置其对应信息 接口：\n请求地址：\r/user/login\r请求方式：\rPOST\r请求参数：\rLoginFormDTO\r返回结果：\rUserLoginVO\r@Override public UserLoginVO login(LoginFormDTO loginDTO) { // 检查用户是否存在 User user = lambdaQuery().eq(User::getUsername, loginDTO.getUsername()).one(); if (user == null) { throw new ForbiddenException(\"用户不存在\"); } else if (user.getStatus() == UserStatus.FROZEN) { throw new ForbiddenException(\"用户状态异常！\"); } else if (!passwordEncoder.matches(loginDTO.getPassword(), user.getPassword())) { throw new ForbiddenException(\"用户密码错误\"); } else { // 生成令牌 String token = jwtTool.createToken(user.getId(), jwtProperties.getTokenTTL()); // 构造返回对象 UserLoginVO userLoginVO = new UserLoginVO(); userLoginVO.setUserId(user.getId()); userLoginVO.setToken(token); userLoginVO.setUsername(user.getUsername()); userLoginVO.setBalance(user.getBalance()); return userLoginVO; } } 黑马商城-商品搜索 需求：需要实现商品分页搜索功能如下：\n根据搜索关键字搜索商品标题 根据品牌、分类、价格范围搜索 商品的状态为1才能被搜索 根据更新时间降序排序 默认搜索第1页；每页大小默认20条 接口：\n请求地址：\r/search/list\r请求方式：\rGET\r请求参数：\rItemPageQuery\r返回结果：\rPageDTO\r@ApiOperation(\"搜索商品\") @GetMapping(\"/list\") public PageDTO\u003cItemDTO\u003e search(ItemPageQuery query) { LambdaQueryChainWrapper\u003cItem\u003e wrapper = itemService.lambdaQuery() .like(StrUtil.isNotBlank(query.getKey()), Item::getName, query.getKey()) .eq(StrUtil.isNotBlank(query.getCategory()), Item::getCategory, query.getCategory()) .eq(StrUtil.isNotBlank(query.getBrand()), Item::getBrand, query.getBrand()) .ge(query.getMinPrice() != null, Item::getPrice, query.getMinPrice()) .le(query.getMaxPrice() != null, Item::getPrice, query.getMaxPrice()); // 处理排序 if (StrUtil.isNotBlank(query.getSortBy())) { switch (query.getSortBy()) { case \"price\": wrapper.orderBy(true, query.getIsAsc(), Item::getPrice); break; case \"sold\": wrapper.orderBy(true, query.getIsAsc(), Item::getSold); break; default: wrapper.orderByDesc(Item::getUpdateTime); break; } } else { // 默认情况下，根据商品的更新实际倒序 wrapper.orderByDesc(Item::getUpdateTime); } Page\u003cItem\u003e page = wrapper.page(Page.of(query.getPageNo(), query.getPageSize())); // return PageDTO.of(result, ItemDTO.class); return PageDTO.of(page, ItemDTO.class); } 黑马商城-购物车 需求：需要实现购物车功能如下：\n在搜索页面中实现 加入购物车 功能 接口：\n请求地址：\r/carts\r请求方式：\rPOST\r请求参数：\rCartFormDTO\r返回结果：\r无\r@Override public void addItem2Cart(CartFormDTO cartFormDTO) { // 如果已经添加过，则添加购买数量；如果没添加过，新增一条购物车记录。一个用户最多添加10个商品 Long userId = UserContext.getUser(); // 1. 检查商品是否已经存在，如果存在则添加数量 if (checkItemExists(cartFormDTO.getItemId(), userId)) { lambdaUpdate() .eq(Cart::getUserId, userId) .eq(Cart::getItemId, cartFormDTO.getItemId()) .setSql(\"num = num + 1\") .update(); } else { // 检查商品数量是否超过限制 checkCartsFull(userId); // 2.如果不存在就新增 Cart cart = BeanUtils.copyProperties(cartFormDTO, Cart.class); cart.setUserId(userId); cart.setNum(1); cart.setCreateTime(LocalDateTime.now()); cart.setUpdateTime(LocalDateTime.now()); save(cart); } private void checkCartsFull(Long userId) { int count = lambdaQuery().eq(Cart::getUserId, userId).count(); if (count \u003e= 10) { throw new BizIllegalException(StrUtil.format(\"用户购物车课程不能超过{}\", 10)); } } private boolean checkItemExists(Long itemId, Long userId) { // select count(*) from cart where user_id = ? and item_id = ? int count = lambdaQuery() .eq(Cart::getUserId, userId) .eq(Cart::getItemId, itemId) .count(); return count \u003e 0; } } 查询当前登录用户的购物车列表 接口： 请求地址：\r/carts\r请求方式：\rGET\r请求参数：\r无\r返回结果：\rList\r@Override public List\u003cCartVO\u003e queryMyCarts() { List\u003cCart\u003e cartList = lambdaQuery() .eq(Cart::getUserId, UserContext.getUser()) .list(); if (CollUtil.isNotEmpty(cartList)) { List\u003cCartVO\u003e cartVOList = BeanUtils.copyToList(cartList, CartVO.class); // 需要包含商品的最新价格、状态、库存等信息。 // select * from item where id in (1,2,3) // 1.1 收集商品id Set\u003cLong\u003e idsSet = cartVOList.stream().map(CartVO::getItemId).collect(Collectors.toSet()); // 1.2 根据商品id集合查询商品列表 List\u003cItem\u003e itemList = itemService.lambdaQuery().in(Item::getId, idsSet).list(); // 1.3 将商品列表 list --\u003emap\u003c商品id,商品\u003e Map\u003cLong, Item\u003e itemMap = itemList.stream().collect(Collectors.toMap(Item::getId, Function.identity())); // 1.4 将每个购物车中的商品信息从map中取出 for (CartVO cartVO : cartVOList) { Item item = itemMap.get(cartVO.getItemId()); cartVO.setNewPrice(item.getPrice()); cartVO.setStatus(item.getStatus()); cartVO.setStock(item.getStock()); } // 2.处理商品信息 return cartVOList; } return null; } ",
  "wordCount" : "5679",
  "inLanguage": "zh",
  "datePublished": "2025-12-30T16:21:57+08:00",
  "dateModified": "2026-01-01T19:56:53+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.steamedfish.top/post/microservices/1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "SteamedFish's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.steamedfish.top/favicon.png"
    }
  }
}
</script>
</head>

<body data-barba="wrapper" class="" id="top">

<div id="aplayer"></div>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.steamedfish.top/" accesskey="h" title="SteamedFish&#39;s Blog (Alt + H)">SteamedFish&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="https://www.steamedfish.top/en/" title="English"
                                aria-label="English">En</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.steamedfish.top/" title="首页">
                    <span>首页</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/archives/" title="归档">
                    <span>归档</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/categories/" title="分类">
                    <span>分类</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/tags/" title="标签">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="https://www.steamedfish.top/about/" title="关于">
                    <span>关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main" data-barba="container" data-barba-namespace="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Mybatis Plus
    </h1>
    <div class="post-meta">






<span title='2025-12-30 16:21:57 +0800 +0800'>2025-12-30</span>&nbsp;·&nbsp;<span title='2026-01-01 19:56:53 +0800 +0800'>(最后修改于 2026-01-01)</span>&nbsp;·&nbsp;<span>12 分钟</span>&nbsp;|&nbsp;<span>
    <a href="https://github.com/LucianChao/Hugo_Blog/tree/main/content/post/microservices/1-mybatisplus/index.md" rel="noopener noreferrer edit" target="_blank">编辑此文章</a>
</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%bb%8b%e7%bb%8d" aria-label="介绍">介绍</a></li>
                <li>
                    <a href="#%e5%bf%ab%e9%80%9f%e5%85%a5%e9%97%a8" aria-label="快速入门">快速入门</a><ul>
                        
                <li>
                    <a href="#%e5%85%a5%e9%97%a8%e6%a1%88%e4%be%8b" aria-label="入门案例">入门案例</a><ul>
                        
                <li>
                    <a href="#%e6%ad%a5%e9%aa%a4" aria-label="步骤">步骤</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e6%b3%a8%e8%a7%a3" aria-label="常见注解">常见注解</a></li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e9%85%8d%e7%bd%ae" aria-label="常见配置">常见配置</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e5%8a%9f%e8%83%bd" aria-label="核心功能">核心功能</a><ul>
                        
                <li>
                    <a href="#%e6%9d%a1%e4%bb%b6%e6%9e%84%e9%80%a0%e5%99%a8" aria-label="条件构造器">条件构造器</a><ul>
                        
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8equerywrapper%e7%9a%84%e6%9f%a5%e8%af%a2" aria-label="基于QueryWrapper的查询">基于QueryWrapper的查询</a></li>
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8eupdatewrapper%e7%9a%84%e6%9b%b4%e6%96%b0" aria-label="基于UpdateWrapper的更新">基于UpdateWrapper的更新</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89sql" aria-label="自定义SQL">自定义SQL</a><ul>
                        
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8ewrapper%e7%9a%84%e5%a4%9a%e8%a1%a8%e5%85%b3%e8%81%94%e6%9f%a5%e8%af%a2" aria-label="基于Wrapper的多表关联查询">基于Wrapper的多表关联查询</a></li></ul>
                </li>
                <li>
                    <a href="#service%e6%8e%a5%e5%8f%a3" aria-label="Service接口">Service接口</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%b5%81%e7%a8%8b" aria-label="使用流程">使用流程</a></li>
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8erestful%e9%a3%8e%e6%a0%bc%e5%ae%9e%e7%8e%b0%e4%b8%8b%e5%88%97%e6%8e%a5%e5%8f%a3" aria-label="基于Restful风格实现下列接口">基于Restful风格实现下列接口</a></li>
                <li>
                    <a href="#iservice%e7%9a%84lambda%e6%9f%a5%e8%af%a2" aria-label="IService的Lambda查询">IService的Lambda查询</a></li>
                <li>
                    <a href="#iservice%e7%9a%84lambda%e6%9b%b4%e6%96%b0" aria-label="IService的Lambda更新">IService的Lambda更新</a></li>
                <li>
                    <a href="#%e9%9c%80%e6%b1%82%e6%89%b9%e9%87%8f%e6%8f%92%e5%85%a510%e4%b8%87%e6%9d%a1%e7%94%a8%e6%88%b7%e6%95%b0%e6%8d%ae%e5%b9%b6%e4%bd%9c%e5%87%ba%e5%af%b9%e6%af%94" aria-label="需求：批量插入10万条用户数据，并作出对比：">需求：批量插入10万条用户数据，并作出对比：</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%8b%93%e5%b1%95%e5%8a%9f%e8%83%bd" aria-label="拓展功能">拓展功能</a><ul>
                        
                <li>
                    <a href="#%e4%bb%a3%e7%a0%81%e7%94%9f%e6%88%90" aria-label="代码生成">代码生成</a></li>
                <li>
                    <a href="#%e9%9d%99%e6%80%81%e5%b7%a5%e5%85%b7" aria-label="静态工具">静态工具</a></li>
                <li>
                    <a href="#%e9%80%bb%e8%be%91%e5%88%a0%e9%99%a4" aria-label="逻辑删除">逻辑删除</a></li>
                <li>
                    <a href="#%e6%9e%9a%e4%b8%be%e5%a4%84%e7%90%86" aria-label="枚举处理">枚举处理</a></li>
                <li>
                    <a href="#json%e5%a4%84%e7%90%86%e5%99%a8" aria-label="JSON处理器">JSON处理器</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e5%8a%a0%e5%af%86" aria-label="配置加密">配置加密</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%8f%92%e4%bb%b6%e5%8a%9f%e8%83%bd" aria-label="插件功能">插件功能</a><ul>
                        
                <li>
                    <a href="#%e5%88%86%e9%a1%b5%e6%8f%92%e4%bb%b6" aria-label="分页插件">分页插件</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e5%8d%95%e5%88%86%e9%a1%b5%e6%9f%a5%e8%af%a2%e6%a1%88%e4%be%8b" aria-label="简单分页查询案例">简单分页查询案例</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%80%9a%e7%94%a8%e5%88%86%e9%a1%b5%e5%ae%9e%e4%bd%93" aria-label="通用分页实体">通用分页实体</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%a1%b9%e7%9b%ae%e5%ae%9e%e6%88%98" aria-label="项目实战">项目实战</a><ul>
                        
                <li>
                    <a href="#%e9%bb%91%e9%a9%ac%e5%95%86%e5%9f%8e-%e7%94%a8%e6%88%b7%e7%99%bb%e5%bd%95" aria-label="黑马商城-用户登录">黑马商城-用户登录</a></li>
                <li>
                    <a href="#%e9%bb%91%e9%a9%ac%e5%95%86%e5%9f%8e-%e5%95%86%e5%93%81%e6%90%9c%e7%b4%a2" aria-label="黑马商城-商品搜索">黑马商城-商品搜索</a></li>
                <li>
                    <a href="#%e9%bb%91%e9%a9%ac%e5%95%86%e5%9f%8e-%e8%b4%ad%e7%89%a9%e8%bd%a6" aria-label="黑马商城-购物车">黑马商城-购物车</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="介绍">介绍<a hidden class="anchor" aria-hidden="true" href="#介绍">#</a></h2>
<p>MybatisPlus（简称 <strong>MP</strong>）是一个 <strong>Mybatis 的增强工具</strong> ，在Mybatis的基础上只做增强不做改变，为<strong>简化开发</strong>、提高效率而生。






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/1.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/1.webp"
      srcset="/post/microservices/1/1.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<hr>
<h2 id="快速入门">快速入门<a hidden class="anchor" aria-hidden="true" href="#快速入门">#</a></h2>
<h3 id="入门案例">入门案例<a hidden class="anchor" aria-hidden="true" href="#入门案例">#</a></h3>
<p>需求：基于资料提供的项目，实现下列功能：</p>
<ol>
<li>新增用户功能</li>
<li>根据id查询用户</li>
<li>根据id批量查询用户</li>
<li>根据id更新用户</li>
<li>根据id删除用户</li>
</ol>
<hr>
<h4 id="步骤">步骤<a hidden class="anchor" aria-hidden="true" href="#步骤">#</a></h4>
<ol>
<li>运行<code>src/test/java/com/itheima/mp/mapper/UserMapperTest.java</code>下的<code>testQueryByIds</code>测试方法，查看环境是否正常






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/4.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/4.webp"
      srcset="/post/microservices/1/4.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>引入MybatisPlus的起步依赖<br>
<code>MyBatisPlus</code>官方提供了<code>starter</code>，其中集成了<code>Mybatis</code>和<code>MybatisPlus</code>的所有功能，并且实现了自动装配效果。<br>
因此我们可以用<code>MybatisPlus</code>的<code>starter</code>代替<code>Mybatis</code>的<code>starter</code>：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/2.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/2.png"
      srcset="/post/microservices/1/2.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/5.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/5.webp"
      srcset="/post/microservices/1/5.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>定义Mapper<br>
自定义的Mapper继承MybatisPlus提供的BaseMapper接口：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/3.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/3.png"
      srcset="/post/microservices/1/3.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>改造Mapper<br>
继承之后删掉Mapper中原本的代码






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/6.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/6.webp"
      srcset="/post/microservices/1/6.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/7.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/7.webp"
      srcset="/post/microservices/1/7.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>修改测试方法，使用<code>Mybatis-plus</code>的方法，查看能否进行增删改查</li>
</ol>
<hr>
<h3 id="常见注解">常见注解<a hidden class="anchor" aria-hidden="true" href="#常见注解">#</a></h3>
<p><strong>MyBatisPlus</strong>通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。</p>
<ul>
<li>类名驼峰转下划线作为表名</li>
<li>名为id的字段作为主键</li>
<li>变量名驼峰转下划线作为表的字段名






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/8.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/8.png"
      srcset="/post/microservices/1/8.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



MybatisPlus中比较常用的几个注解如下：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/10.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/10.png"
      srcset="/post/microservices/1/10.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="https://www.steamedfish.top/9.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="https://www.steamedfish.top/9.png"
      srcset="https://www.steamedfish.top/9.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li><code>@TableName</code>：用来指定表名</li>
<li><code>@TableId</code>：用来指定表中的主键字段信息
<ul>
<li><code>IdType</code>枚举：
<ul>
<li><code>AUTO</code>：数据库自增长</li>
<li><code>INPUT</code>：通过set方法自行输入</li>
<li><code>ASSIGN_ID</code>：分配 <code>ID</code>，接口<code>IdentifierGenerator</code>的方法<code>nextId</code>来生成<code>id</code>，默认实现类为<code>DefaultIdentifierGenerator</code>雪花算法</li>
</ul>
</li>
</ul>
</li>
<li><code>@TableField</code>：用来指定表中的普通字段信息
<ul>
<li>使用@TableField的常见场景：
<ul>
<li>成员变量名与数据库字段名不一致</li>
<li>成员变量名以is开头，且是布尔值</li>
<li>成员变量名与数据库关键字冲突</li>
<li>成员变量不是数据库字段</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="常见配置">常见配置<a hidden class="anchor" aria-hidden="true" href="#常见配置">#</a></h3>
<p>MyBatisPlus的配置项继承了MyBatis原生配置和一些自己特有的配置。例如：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/11.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/11.png"
      srcset="/post/microservices/1/11.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



具体可参考官方文档：<a href="https://baomidou.com/reference/">使用配置 | MyBatis-Plus</a></p>
<hr>
<h2 id="核心功能">核心功能<a hidden class="anchor" aria-hidden="true" href="#核心功能">#</a></h2>
<h3 id="条件构造器">条件构造器<a hidden class="anchor" aria-hidden="true" href="#条件构造器">#</a></h3>
<p><strong>MyBatisPlus</strong>支持各种复杂的<code>where</code>条件，可以满足日常开发的所有需求。






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/14.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/14.png"
      srcset="/post/microservices/1/14.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/12.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/12.png"
      srcset="/post/microservices/1/12.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/13.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/13.png"
      srcset="/post/microservices/1/13.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<h4 id="基于querywrapper的查询">基于QueryWrapper的查询<a hidden class="anchor" aria-hidden="true" href="#基于querywrapper的查询">#</a></h4>
<p>需求：</p>
<ol>
<li>查询出名字中带o的，存款大于等于1000元的人的id、username、info、balance字段






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/15.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/15.png"
      srcset="/post/microservices/1/15.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testQueryWrapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//条件构造器</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queryWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//查询的列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">queryWrapper</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;info&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;balance&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//查询条件： 名字带`o`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">queryWrapper</span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;o&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//查询条件： 存款大于等于1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">queryWrapper</span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="s">&#34;balance&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">queryWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//输出</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//userList.forEach(System.out::println);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">userList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testLambdaQueryWrapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">LambdaQueryWrapper</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lambdaQueryWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LambdaQueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">lambdaQueryWrapper</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getId</span><span class="p">,</span><span class="n">User</span><span class="p">::</span><span class="n">getUsername</span><span class="p">,</span><span class="n">User</span><span class="p">::</span><span class="n">getInfo</span><span class="p">,</span><span class="n">User</span><span class="p">::</span><span class="n">getBalance</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">lambdaQueryWrapper</span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getUsername</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;o&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">lambdaQueryWrapper</span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getBalance</span><span class="p">,</span><span class="w"> </span><span class="n">1000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">selectList</span><span class="p">(</span><span class="n">lambdaQueryWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">userList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<!-- FM:Snippet:Start data:{"id":"st-notice","fields":[]} -->
<style type="text/css">
     
    .notice {
        --title-color: #fff;
        --title-background-color: #6be;
        --content-color: #444;
        --content-background-color: #e7f2fa;
    }

    .notice.info {
        --title-background-color: #fb7;
        --content-background-color: #fec;
    }

    .notice.tip {
        --title-background-color: #5a5;
        --content-background-color: #efe;
    }

    .notice.warning {
        --title-background-color: #c33;
        --content-background-color: #fee;
    }

     
    

    body.dark .notice {
        --title-color: #fff;
        --title-background-color: #069;
        --content-color: #ddd;
        --content-background-color: #023;
    }

    body.dark .notice.info {
        --title-background-color: #a50;
        --content-background-color: #420;
    }

    body.dark .notice.tip {
        --title-background-color: #363;
        --content-background-color: #121;
    }

    body.dark .notice.warning {
        --title-background-color: #800;
        --content-background-color: #400;
    }

     
    .notice {
        padding: 18px;
        line-height: 24px;
        margin-bottom: 24px;
        border-radius: 4px;
        color: var(--content-color);
        background: var(--content-background-color);
    }

    .notice p:last-child {
        margin-bottom: 0
    }

     
    .notice-title {
        margin: -18px -18px 12px;
        padding: 4px 18px;
        border-radius: 4px 4px 0 0;
        font-weight: 700;
        color: var(--title-color);
        background: var(--title-background-color);
    }

     
    .icon-notice {
        display: inline-flex;
        align-self: center;
        margin-right: 8px;
    }

    .icon-notice img,
    .icon-notice svg {
        height: 1em;
        width: 1em;
        fill: currentColor;
    }

    .icon-notice img,
    .icon-notice.baseline svg {
        top: .125em;
        position: relative;
    }
</style><div class="notice tip" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/></svg>
        </span>提示</p><ul>
<li>尽量使用<code>LambdaQueryWrapper</code>和<code>LambdaUpdateWrapper</code>，避免硬编码</li>
<li><code>QueryWrapper</code>和<code>LambdaQueryWrapper</code>通常用来构建<code>select</code>、<code>delete</code>、<code>update</code>的<code>where</code>条件部分</li>
<li><code>UpdateWrapper</code>和<code>LambdaUpdateWrapper</code>通常只有在<code>set</code>语句比较特殊才使用</li>
</ul></div>
<!-- FM:Snippet:End -->
<ol start="2">
<li>更新用户名为jack的用户的余额为2000






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/16.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/16.png"
      srcset="/post/microservices/1/16.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testQueryWrapperUpdate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">user</span><span class="p">.</span><span class="na">setBalance</span><span class="p">(</span><span class="n">2000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queryWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">queryWrapper</span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="s">&#34;username&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;jack&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userMapper</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">queryWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<h4 id="基于updatewrapper的更新">基于UpdateWrapper的更新<a hidden class="anchor" aria-hidden="true" href="#基于updatewrapper的更新">#</a></h4>
<p>需求：更新id为1,2,4的用户的余额，扣200






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/17.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/17.png"
      srcset="/post/microservices/1/17.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// update user set balance = balance - 200 where id in (1, 2, 4);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nd">@Test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testUpdateWrapper</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">UpdateWrapper</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updateWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UpdateWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//自定义更新语句，设置的是set</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">updateWrapper</span><span class="p">.</span><span class="na">setSql</span><span class="p">(</span><span class="s">&#34;balance = balance - 200&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//id为1，2，4的用户 -- where id in (1,2,4)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">updateWrapper</span><span class="p">.</span><span class="na">in</span><span class="p">(</span><span class="s">&#34;id&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="n">4</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">userMapper</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">updateWrapper</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h3 id="自定义sql">自定义SQL<a hidden class="anchor" aria-hidden="true" href="#自定义sql">#</a></h3>
<p>我们可以利用<code>yBatisPlus</code>的<code>Wrapper</code>来构建复杂的<code>Where</code>条件，然后自己定义SQL语句中剩下的部分。






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/18.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/18.png"
      srcset="/post/microservices/1/18.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<ol>
<li>基于Wrapper构建where条件






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/19.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/19.png"
      srcset="/post/microservices/1/19.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>在mapper方法参数中用Param注解声明wrapper变量名称，必须是ew






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/20.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/20.png"
      srcset="/post/microservices/1/20.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>自定义SQL，并使用Wrapper条件






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/21.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/21.png"
      srcset="/post/microservices/1/21.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ol>
<h4 id="基于wrapper的多表关联查询">基于Wrapper的多表关联查询<a hidden class="anchor" aria-hidden="true" href="#基于wrapper的多表关联查询">#</a></h4>
<p>需求：查询出所有收货地址在北京的并且用户id在指定范围的用户（例如1、2、4 ）的用户






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/26.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/26.png"
      srcset="/post/microservices/1/26.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<hr>
<h3 id="service接口">Service接口<a hidden class="anchor" aria-hidden="true" href="#service接口">#</a></h3>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/22.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/22.png"
      srcset="/post/microservices/1/22.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/23.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/23.png"
      srcset="/post/microservices/1/23.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<h4 id="使用流程">使用流程<a hidden class="anchor" aria-hidden="true" href="#使用流程">#</a></h4>
<ol>
<li>自定义Service接口继承IService接口






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/24.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/24.png"
      srcset="/post/microservices/1/24.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>自定义Service实现类，实现自定义接口并继承ServiceImpl类</li>
</ol>
<h4 id="基于restful风格实现下列接口">基于Restful风格实现下列接口<a hidden class="anchor" aria-hidden="true" href="#基于restful风格实现下列接口">#</a></h4>
<p>需求：基于Restful风格实现下面的接口：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/25.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/25.png"
      srcset="/post/microservices/1/25.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



分析：<code>1,2,3,4</code>是常见的基本接口，可以直接在<code>controller</code>中调用<code>mybatisPlus</code>的<code>service</code>接口提供的方法实现；不需要再写任何业务方法<br>
<code>5</code>这个接口有特别的业务逻辑（判断用户正常（不为2）、余额充足才能做扣减），需要在<code>Service</code>中新增方法来实现</p>
<ol>
<li>要编写具体的接口，实现web功能；需要引入<code>spring-boot-starter-web</code>；<br>
另外为了方便测试可以引入<code>knife4j</code>的依赖；通过访问界面来测试所写的接口。<br>
因此我们可以添加如下依赖：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/27.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/27.webp"
      srcset="/post/microservices/1/27.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>要能够被<code>swagger</code>可访问测试接口的话，在处理编写时可以设置对应注解，示例如下：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/28.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/28.webp"
      srcset="/post/microservices/1/28.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>新增业务方法
特殊的业务方法，<code>mybatisPlus</code>中没有提供的，则可以自定义编写






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/29.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/29.webp"
      srcset="/post/microservices/1/29.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ol>
<h4 id="iservice的lambda查询">IService的Lambda查询<a hidden class="anchor" aria-hidden="true" href="#iservice的lambda查询">#</a></h4>
<p>需求：实现一个根据复杂条件查询用户的接口，查询条件如下：</p>
<ul>
<li><code>name</code>：用户名关键字，可以为空</li>
<li><code>status</code>：用户状态，可以为空</li>
<li><code>minBalance</code>：最小余额，可以为空</li>
<li><code>maxBalance</code>：最大余额，可以为空






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/30.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/30.webp"
      srcset="/post/microservices/1/30.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Operation</span><span class="p">(</span><span class="n">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;根据条件查询用户列表&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&#34;/list&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserVO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">queryList</span><span class="p">(</span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">UserQuery</span><span class="w"> </span><span class="n">userQuery</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQuery</span><span class="p">.</span><span class="na">getName</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQuery</span><span class="p">.</span><span class="na">getStatus</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">minBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQuery</span><span class="p">.</span><span class="na">getMinBalance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Integer</span><span class="w"> </span><span class="n">maxBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userQuery</span><span class="p">.</span><span class="na">getMaxBalance</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queryWrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">QueryWrapper</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// if (StrUtil.isNotBlank(username)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     queryWrapper.lambda().like(User::getUsername,username);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// }</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// v2.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 条件成立就把条件添加到where中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// queryWrapper.lambda().like(StrUtil.isNotBlank(username), User::getUsername, username)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//         .eq(status != null, User::getStatus, status)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//         .ge(minBalance != null, User::getBalance, minBalance)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//         .le(maxBalance != null, User::getBalance, maxBalance);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// List&lt;User&gt; list = userService.list(queryWrapper);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// v3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">isNotBlank</span><span class="p">(</span><span class="n">username</span><span class="p">),</span><span class="w"> </span><span class="n">User</span><span class="p">::</span><span class="n">getUsername</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="p">::</span><span class="n">getStatus</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="n">minBalance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="p">::</span><span class="n">getBalance</span><span class="p">,</span><span class="w"> </span><span class="n">minBalance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">le</span><span class="p">(</span><span class="n">maxBalance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">User</span><span class="p">::</span><span class="n">getBalance</span><span class="p">,</span><span class="w"> </span><span class="n">maxBalance</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w">    </span><span class="c1">//最终进行查询</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="n">UserVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><!-- FM:Snippet:Start data:{"id":"st-notice","fields":[]} -->
<div class="notice info" >
    <p class="notice-title">
        <span class="icon-notice baseline">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
        </span>信息</p><p>这种代码并不规范，超出了Controller的职责范围，Controller应该只负责接收请求和调用接口，具体的业务逻辑应该在service层中实现</p></div>
<!-- FM:Snippet:End -->
<h4 id="iservice的lambda更新">IService的Lambda更新<a hidden class="anchor" aria-hidden="true" href="#iservice的lambda更新">#</a></h4>
<p>需求：改造根据id修改用户余额的接口，要求如下：</p>
<ul>
<li>完成对用户状态校验</li>
<li>完成对用户余额校验</li>
<li>如果扣减后余额为0，则将用户status修改为冻结状态（2）</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">deductionBalanceById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     1.判断用户是否正常（账户状态）</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;用户状态异常或者用户不存在&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     2.判断余额是否充足，当前账户余额 - 扣减金额 &gt; 0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getBalance</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;余额不足&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//     3.扣减金额</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 获取扣减之后的余额</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">remainBalance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getBalance</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// userMapper.updateBalanceById(id, amount);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// update user set balance = ? ,status = 2 where id = ?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// update user set balance = ? where id = ?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">lambdaUpdate</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getBalance</span><span class="p">,</span><span class="n">remainBalance</span><span class="p">)</span><span class="w">    </span><span class="c1">//设置余额</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">remainBalance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">0</span><span class="p">,</span><span class="n">User</span><span class="p">::</span><span class="n">getStatus</span><span class="p">,</span><span class="n">2</span><span class="p">)</span><span class="w">  </span><span class="c1">//账户余额为0，账户状态改为2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getId</span><span class="p">,</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="c1">//设置id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h4 id="需求批量插入10万条用户数据并作出对比">需求：批量插入10万条用户数据，并作出对比：<a hidden class="anchor" aria-hidden="true" href="#需求批量插入10万条用户数据并作出对比">#</a></h4>
<ul>
<li>
<p>普通<code>for</code>循环插入






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/31.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/31.webp"
      srcset="/post/microservices/1/31.webp 2x"
      alt="耗时：609121毫秒（≈6分钟）"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption">耗时：609121毫秒（≈6分钟）</figcaption>
  
</div>


</p>
</li>
<li>
<p><code>IService</code>的批量插入






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/32.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/32.webp"
      srcset="/post/microservices/1/32.webp 2x"
      alt="耗时：25922毫秒（≈25秒）"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption">耗时：25922毫秒（≈25秒）</figcaption>
  
</div>


</p>
</li>
<li>
<p>开启<code>rewriteBatchedStatements=true</code>参数，再次执行<code>saveBatch()</code>






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/33.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/33.webp"
      srcset="/post/microservices/1/33.webp 2x"
      alt="耗时：9860毫秒（≈10秒"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption">耗时：9860毫秒（≈10秒</figcaption>
  
</div>


</p>
</li>
<li>
<p>结论：</p>
<ul>
<li>批处理方案：
<ul>
<li>普通for循环逐条插入速度极差，不推荐</li>
<li>MP的批量新增，基于预编译的批处理，性能不错</li>
<li>配置jdbc参数，开rewriteBatchedStatements，<strong>性能最好</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="拓展功能">拓展功能<a hidden class="anchor" aria-hidden="true" href="#拓展功能">#</a></h2>
<h3 id="代码生成">代码生成<a hidden class="anchor" aria-hidden="true" href="#代码生成">#</a></h3>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/34.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/34.png"
      srcset="/post/microservices/1/34.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/35.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/35.png"
      srcset="/post/microservices/1/35.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/36.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/36.webp"
      srcset="/post/microservices/1/36.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/37.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/37.webp"
      srcset="/post/microservices/1/37.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/38.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/38.webp"
      srcset="/post/microservices/1/38.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/39.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/39.webp"
      srcset="/post/microservices/1/39.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/40.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/40.webp"
      srcset="/post/microservices/1/40.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<hr>
<h3 id="静态工具">静态工具<a hidden class="anchor" aria-hidden="true" href="#静态工具">#</a></h3>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/41.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/41.png"
      srcset="/post/microservices/1/41.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



需求：</p>
<ol>
<li>改造根据id查询用户的接口，查询用户的同时，查询出用户对应的所有地址
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">UserVO</span><span class="w"> </span><span class="nf">queryUserAndAddressesById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 1.查询用户信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">UserVO</span><span class="w"> </span><span class="n">userVO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">UserVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 2.根据用户id查询其对应的用户地址列表，然后转换为vo列表，设置进userVO中</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Db</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Address</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AddressVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressVOS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">addressList</span><span class="p">,</span><span class="w"> </span><span class="n">AddressVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">userVO</span><span class="p">.</span><span class="na">setAddresses</span><span class="p">(</span><span class="n">addressVOS</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">userVO</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>改造根据id批量查询用户的接口，查询用户的同时，查询出用户对应的所有地址
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="w"> </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserVO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">queryUserAndAddressesByIds</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 1.根据id查询用户列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listByIds</span><span class="p">(</span><span class="n">ids</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userVOList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">userList</span><span class="p">,</span><span class="w"> </span><span class="n">UserVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 2.根据id查询用户对应的地址列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Db</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">in</span><span class="p">(</span><span class="n">Address</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">ids</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AddressVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressVOS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">addressList</span><span class="p">,</span><span class="w"> </span><span class="n">AddressVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 将地址列表集合转换为：map&lt;用户id,地址列表&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AddressVO</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">userAddressMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">addressVOS</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">groupingBy</span><span class="p">(</span><span class="n">AddressVO</span><span class="p">::</span><span class="n">getUserId</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="c1">// 就可以循环用户列表，根据用户id从map中获取对应的地址列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">UserVO</span><span class="w"> </span><span class="n">userVO</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">userVOList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AddressVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressVOList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userAddressMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">userVO</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="n">userVO</span><span class="p">.</span><span class="na">setAddresses</span><span class="p">(</span><span class="n">addressVOList</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">userVOList</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
<li>实现根据用户id查询收货地址功能，需要验证用户状态，冻结用户抛出异常（练习）
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AddressVO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">queryAddressesById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UserStatus</span><span class="p">.</span><span class="na">FROZEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;用户状态异常或者用户不存在&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">addressList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Db</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Address</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BeanUtil</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">addressList</span><span class="p">,</span><span class="w"> </span><span class="n">AddressVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ol>
<hr>
<h3 id="逻辑删除">逻辑删除<a hidden class="anchor" aria-hidden="true" href="#逻辑删除">#</a></h3>
<p><strong>逻辑删除</strong>就是基于代码逻辑模拟删除效果，但并不会真正删除数据。思路如下：</p>
<ul>
<li>在表中添加一个字段标记数据是否被删除</li>
<li>当删除数据时把标记置为1</li>
<li>查询时只查询标记为0的数据</li>
</ul>
<p>例如逻辑删除字段为<code>deleted</code>：
删除操作：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/42.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/42.png"
      srcset="/post/microservices/1/42.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



查询操作：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/43.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/43.png"
      srcset="/post/microservices/1/43.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



<strong>MybatisPlus</strong>提供了逻辑删除功能，<strong>无需改变方法调用的方式</strong>，而是在底层帮我们自动修改CRUD的语句。我们要做的就是在application.yaml文件中配置逻辑删除的字段名称和值即可：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/44.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/44.png"
      srcset="/post/microservices/1/44.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<h3 id="枚举处理">枚举处理<a hidden class="anchor" aria-hidden="true" href="#枚举处理">#</a></h3>
<p>步骤：</p>
<ol>
<li>在<code>application.yml</code>中配置全局枚举处理器






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/45.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/45.png"
      srcset="/post/microservices/1/45.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
<li>创建枚举类与修改属性类型
<ul>
<li><code>/enums/UserStatus.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.itheima.mp.enums</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.baomidou.mybatisplus.annotation.EnumValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">com.fasterxml.jackson.annotation.JsonValue</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Getter</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Getter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">UserStatus</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">NORMAL</span><span class="p">(</span><span class="n">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;正常&#34;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">FROZEN</span><span class="p">(</span><span class="n">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;冻结&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 保存到数据库中的值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@EnumValue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 在序列化时候，使用的值</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@JsonValue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">UserStatus</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">code</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/46.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/46.webp"
      srcset="/post/microservices/1/46.webp 2x"
      alt="User属性类型修改（UserVO也要修改）"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption"><code>User</code>属性类型修改（<code>UserVO</code>也要修改）</figcaption>
  
</div>


</li>
<li>测试：访问根据id查询用户接口






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/47.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/47.webp"
      srcset="/post/microservices/1/47.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ol>
<hr>
<h3 id="json处理器">JSON处理器<a hidden class="anchor" aria-hidden="true" href="#json处理器">#</a></h3>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/48.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/48.png"
      srcset="/post/microservices/1/48.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



步骤：</p>
<ol>
<li>创建UserInfo类
<ul>
<li><code>/domain/po/UserInfo.java</code>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nn">com.itheima.mp.domain.po</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="nn">lombok.Data</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@Data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserInfo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//     简介</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">intro</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//     年龄</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">age</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="c1">//     性别</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">gender</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div></li>
</ul>
</li>
<li>修改User及UserVO






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/49.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/49.webp"
      srcset="/post/microservices/1/49.webp 2x"
      alt="User"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption"><code>User</code></figcaption>
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/50.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/50.webp"
      srcset="/post/microservices/1/50.webp 2x"
      alt="User"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption"><code>User</code></figcaption>
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/51.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/51.webp"
      srcset="/post/microservices/1/51.webp 2x"
      alt="UserInfo"
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
  <figcaption class="post-img-view-caption"><code>UserInfo</code></figcaption>
  
</div>


</li>
<li>测试：访问根据id查询用户接口






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/52.webp"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/52.webp"
      srcset="/post/microservices/1/52.webp 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</li>
</ol>
<hr>
<h3 id="配置加密">配置加密<a hidden class="anchor" aria-hidden="true" href="#配置加密">#</a></h3>
<p><code>MyBatisPlus</code>从3.3.2版本开始提供了一个基于AES算法的加密工具，帮助我们对配置中的敏感信息做加密处理。






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/53.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/53.png"
      srcset="/post/microservices/1/53.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



在<code>application.yaml</code>文件中使用刚刚生成的秘钥，代替明文的用户名和密码






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/54.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/54.png"
      srcset="/post/microservices/1/54.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



在项目启动的时候，添加AES的秘钥，这样MyBatisPlus就可以解密数据了：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/55.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/55.png"
      srcset="/post/microservices/1/55.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



单元测试时，可以通过<code>@SpringBootTest</code>来指定秘钥：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/56.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/56.png"
      srcset="/post/microservices/1/56.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



Idea中则可以通过Program arguments来配置：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/57.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/57.png"
      srcset="/post/microservices/1/57.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<hr>
<h2 id="插件功能">插件功能<a hidden class="anchor" aria-hidden="true" href="#插件功能">#</a></h2>
<p>MyBatisPlus基于MyBatis的Interceptor实现了一个基础拦截器，并在内部保存了MyBatisPlus的内置拦截器的集合：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/58.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/58.png"
      srcset="/post/microservices/1/58.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



MyBatisPlus提供的内置拦截器有下面这些：</p>




<table>

    <thead>
      <tr>
          <th style="text-align: center">序号</th>
          <th style="text-align: center">拦截器</th>
          <th style="text-align: center">描述</th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">1</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>TenantLineInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">多租户插件</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">2</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>DynamicTableNameInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">动态表名插件</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">3</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>PaginationInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">分页插件</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">4</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>OptimisticLockerInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">乐观锁插件</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">5</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>IllegalsQLInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">SQL性能规范插件，检测并拦截垃圾SQL</td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">6</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center"><code>BlockAttackInnerInterceptor</code></td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: center">防止全表更新和删除的插件</td>
      </tr>
  </tbody>
</table><hr>
<h3 id="分页插件">分页插件<a hidden class="anchor" aria-hidden="true" href="#分页插件">#</a></h3>
<p>首先，要在配置类中注册MyBatisPlus的核心插件，同时添加分页插件.就可以在mapper或者service中带有page字段或者参数为pager的方法中使用了：</p>
<ul>
<li>在3.5.9版本之后，MyBatis Plus 对组件做了拆分，比如分页功能依赖的 <code>jsqlparser</code> 被单独拆成了 <code>mybatis-plus-jsqlparser</code> 包。需要手动添加依赖，否则 PaginationInnerInterceptor 会找不到所需的解析工具。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--mybatisplus分页插件--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;groupId&gt;</span>com.baomidou<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;artifactId&gt;</span>mybatis-plus-jsqlparser<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;version&gt;</span>3.5.15<span class="nt">&lt;/version&gt;</span> <span class="c">&lt;!-- 确保版本和 MyBatis Plus 主包一致 --&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div></li>
</ul>
<p>





    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/59.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/59.png"
      srcset="/post/microservices/1/59.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



接着，就可以使用分页的API了






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/60.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/60.png"
      srcset="/post/microservices/1/60.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/61.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/61.png"
      srcset="/post/microservices/1/61.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>









    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/62.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/62.png"
      srcset="/post/microservices/1/62.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<h4 id="简单分页查询案例">简单分页查询案例<a hidden class="anchor" aria-hidden="true" href="#简单分页查询案例">#</a></h4>
<p>需求：遵循下面的接口规范，编写一个UserController接口，实现User的分页查询






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/63.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/63.png"
      srcset="/post/microservices/1/63.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>



返回值：






    


       
    



<div class="post-img-view">
  <a
    data-fancybox="post-post/microservices/1-mybatisplus/index.md"
    href="/post/microservices/1/64.png"
    data-caption=""
    data-barba-prevent="all"
  >
    <img
      src="/post/microservices/1/64.png"
      srcset="/post/microservices/1/64.png 2x"
      alt=""
      loading="lazy"
      style="max-width: 100%; height: auto;"
    />
  </a>
    
  
</div>


</p>
<hr>
<h3 id="通用分页实体">通用分页实体<a hidden class="anchor" aria-hidden="true" href="#通用分页实体">#</a></h3>
<p>需求：
在PageQuery中定义方法，将PageQuery对象转为MyBatisPlus中的Page对象
在PageDTO中定义方法，将MyBatisPlus中的Page结果转为PageDTO结果</p>
<h2 id="项目实战">项目实战<a hidden class="anchor" aria-hidden="true" href="#项目实战">#</a></h2>
<h3 id="黑马商城-用户登录">黑马商城-用户登录<a hidden class="anchor" aria-hidden="true" href="#黑马商城-用户登录">#</a></h3>
<p>需求：需要实现用户输入用户名和密码的登录功能：</p>
<ul>
<li>校验用户名是否存在</li>
<li>用户的状态是否被冻结，冻结则不能登录</li>
<li>校验用户的密码是否正确</li>
<li>都正确的情况下，根据用户id生成token令牌</li>
<li>返回UserLoginVO并设置其对应信息</li>
</ul>
<p>接口：</p>




<table>

    <thead>
      <tr>
          <th style="text-align: left"></th>
          <th></th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求地址：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>/user/login</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求方式：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>POST</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求参数：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>LoginFormDTO</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">返回结果：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>UserLoginVO</code></td>
      </tr>
  </tbody>
</table><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">UserLoginVO</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">LoginFormDTO</span><span class="w"> </span><span class="n">loginDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 检查用户是否存在</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambdaQuery</span><span class="p">().</span><span class="na">eq</span><span class="p">(</span><span class="n">User</span><span class="p">::</span><span class="n">getUsername</span><span class="p">,</span><span class="w"> </span><span class="n">loginDTO</span><span class="p">.</span><span class="na">getUsername</span><span class="p">()).</span><span class="na">one</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ForbiddenException</span><span class="p">(</span><span class="s">&#34;用户不存在&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UserStatus</span><span class="p">.</span><span class="na">FROZEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ForbiddenException</span><span class="p">(</span><span class="s">&#34;用户状态异常！&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">passwordEncoder</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="n">loginDTO</span><span class="p">.</span><span class="na">getPassword</span><span class="p">(),</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ForbiddenException</span><span class="p">(</span><span class="s">&#34;用户密码错误&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 生成令牌</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jwtTool</span><span class="p">.</span><span class="na">createToken</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">jwtProperties</span><span class="p">.</span><span class="na">getTokenTTL</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// 构造返回对象</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">UserLoginVO</span><span class="w"> </span><span class="n">userLoginVO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserLoginVO</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userLoginVO</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userLoginVO</span><span class="p">.</span><span class="na">setToken</span><span class="p">(</span><span class="n">token</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userLoginVO</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">userLoginVO</span><span class="p">.</span><span class="na">setBalance</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getBalance</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userLoginVO</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h3 id="黑马商城-商品搜索">黑马商城-商品搜索<a hidden class="anchor" aria-hidden="true" href="#黑马商城-商品搜索">#</a></h3>
<p>需求：需要实现商品分页搜索功能如下：</p>
<ul>
<li>根据搜索关键字搜索商品标题</li>
<li>根据品牌、分类、价格范围搜索</li>
<li>商品的状态为1才能被搜索</li>
<li>根据更新时间降序排序</li>
<li>默认搜索第1页；每页大小默认20条</li>
</ul>
<p>接口：</p>




<table>

    <thead>
      <tr>
          <th style="text-align: left"></th>
          <th></th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求地址：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>/search/list</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求方式：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>GET</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求参数：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>ItemPageQuery</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">返回结果：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>PageDTO&lt;ItemDTO&gt;</code></td>
      </tr>
  </tbody>
</table><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ApiOperation</span><span class="p">(</span><span class="s">&#34;搜索商品&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/list&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">PageDTO</span><span class="o">&lt;</span><span class="n">ItemDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="n">ItemPageQuery</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">LambdaQueryChainWrapper</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemService</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">isNotBlank</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getKey</span><span class="p">()),</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getName</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getKey</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">isNotBlank</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getCategory</span><span class="p">()),</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getCategory</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getCategory</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">isNotBlank</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getBrand</span><span class="p">()),</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getBrand</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getBrand</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">ge</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getMinPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getPrice</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getMinPrice</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">.</span><span class="na">le</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getMaxPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getPrice</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getMaxPrice</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// 处理排序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">isNotBlank</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getSortBy</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getSortBy</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#34;price&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">wrapper</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getIsAsc</span><span class="p">(),</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getPrice</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&#34;sold&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">wrapper</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getIsAsc</span><span class="p">(),</span><span class="w"> </span><span class="n">Item</span><span class="p">::</span><span class="n">getSold</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">wrapper</span><span class="p">.</span><span class="na">orderByDesc</span><span class="p">(</span><span class="n">Item</span><span class="p">::</span><span class="n">getUpdateTime</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">//     默认情况下，根据商品的更新实际倒序</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">wrapper</span><span class="p">.</span><span class="na">orderByDesc</span><span class="p">(</span><span class="n">Item</span><span class="p">::</span><span class="n">getUpdateTime</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Page</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wrapper</span><span class="p">.</span><span class="na">page</span><span class="p">(</span><span class="n">Page</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="na">getPageNo</span><span class="p">(),</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">getPageSize</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// return PageDTO.of(result, ItemDTO.class);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PageDTO</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">page</span><span class="p">,</span><span class="w"> </span><span class="n">ItemDTO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><hr>
<h3 id="黑马商城-购物车">黑马商城-购物车<a hidden class="anchor" aria-hidden="true" href="#黑马商城-购物车">#</a></h3>
<p>需求：需要实现购物车功能如下：</p>
<ol>
<li>在搜索页面中实现 加入购物车 功能</li>
</ol>
<p>接口：</p>




<table>

    <thead>
      <tr>
          <th style="text-align: left"></th>
          <th></th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求地址：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>/carts</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求方式：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>POST</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求参数：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>CartFormDTO</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">返回结果：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>无</code></td>
      </tr>
  </tbody>
</table><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addItem2Cart</span><span class="p">(</span><span class="n">CartFormDTO</span><span class="w"> </span><span class="n">cartFormDTO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// 如果已经添加过，则添加购买数量；如果没添加过，新增一条购物车记录。一个用户最多添加10个商品</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserContext</span><span class="p">.</span><span class="na">getUser</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// 1. 检查商品是否已经存在，如果存在则添加数量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">checkItemExists</span><span class="p">(</span><span class="n">cartFormDTO</span><span class="p">.</span><span class="na">getItemId</span><span class="p">(),</span><span class="w"> </span><span class="n">userId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">lambdaUpdate</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getItemId</span><span class="p">,</span><span class="w"> </span><span class="n">cartFormDTO</span><span class="p">.</span><span class="na">getItemId</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">.</span><span class="na">setSql</span><span class="p">(</span><span class="s">&#34;num = num + 1&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="p">.</span><span class="na">update</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 检查商品数量是否超过限制</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">checkCartsFull</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 2.如果不存在就新增</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">Cart</span><span class="w"> </span><span class="n">cart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">cartFormDTO</span><span class="p">,</span><span class="w"> </span><span class="n">Cart</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">cart</span><span class="p">.</span><span class="na">setUserId</span><span class="p">(</span><span class="n">userId</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">cart</span><span class="p">.</span><span class="na">setNum</span><span class="p">(</span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">cart</span><span class="p">.</span><span class="na">setCreateTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">cart</span><span class="p">.</span><span class="na">setUpdateTime</span><span class="p">(</span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">save</span><span class="p">(</span><span class="n">cart</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkCartsFull</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambdaQuery</span><span class="p">().</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">).</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">10</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BizIllegalException</span><span class="p">(</span><span class="n">StrUtil</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&#34;用户购物车课程不能超过{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">10</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">checkItemExists</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">itemId</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c1">// select count(*) from cart where user_id = ? and item_id = ?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambdaQuery</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getItemId</span><span class="p">,</span><span class="w"> </span><span class="n">itemId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">count</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><ol>
<li>查询当前登录用户的购物车列表
接口：




<table>

    <thead>
      <tr>
          <th style="text-align: left"></th>
          <th></th>
      </tr>
    </thead>
    <tbody>
    
    
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求地址：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>/carts</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求方式：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>GET</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">请求参数：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>无</code></td>
      </tr>
        
        
        
      <tr>
        
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left">返回结果：</td>
            
            
            
            
            
                
                
                
                
                
                
                
                
                
                
                
                <td rowspan="1" colspan="1" style="text-align: left"><code>List&lt;CartVO&gt;</code></td>
      </tr>
  </tbody>
</table></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">queryMyCarts</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Cart</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cartList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambdaQuery</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">eq</span><span class="p">(</span><span class="n">Cart</span><span class="p">::</span><span class="n">getUserId</span><span class="p">,</span><span class="w"> </span><span class="n">UserContext</span><span class="p">.</span><span class="na">getUser</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">.</span><span class="na">list</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CollUtil</span><span class="p">.</span><span class="na">isNotEmpty</span><span class="p">(</span><span class="n">cartList</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cartVOList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyToList</span><span class="p">(</span><span class="n">cartList</span><span class="p">,</span><span class="w"> </span><span class="n">CartVO</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 需要包含商品的最新价格、状态、库存等信息。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// select * from item where id in (1,2,3)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 1.1 收集商品id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">idsSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cartVOList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">CartVO</span><span class="p">::</span><span class="n">getItemId</span><span class="p">).</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toSet</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 1.2 根据商品id集合查询商品列表</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">itemList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemService</span><span class="p">.</span><span class="na">lambdaQuery</span><span class="p">().</span><span class="na">in</span><span class="p">(</span><span class="n">Item</span><span class="p">::</span><span class="n">getId</span><span class="p">,</span><span class="w"> </span><span class="n">idsSet</span><span class="p">).</span><span class="na">list</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 1.3  将商品列表 list --&gt;map&lt;商品id,商品&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">itemMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemList</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toMap</span><span class="p">(</span><span class="n">Item</span><span class="p">::</span><span class="n">getId</span><span class="p">,</span><span class="w"> </span><span class="n">Function</span><span class="p">.</span><span class="na">identity</span><span class="p">()));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 1.4  将每个购物车中的商品信息从map中取出</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">CartVO</span><span class="w"> </span><span class="n">cartVO</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">cartVOList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemMap</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">cartVO</span><span class="p">.</span><span class="na">getItemId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">cartVO</span><span class="p">.</span><span class="na">setNewPrice</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getPrice</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">cartVO</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="n">cartVO</span><span class="p">.</span><span class="na">setStock</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="na">getStock</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c1">// 2.处理商品信息</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">cartVOList</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://www.steamedfish.top/">©2025 SteamedFish&rsquo;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>
<script src="https://unpkg.com/@barba/core"></script>


<script>
  window.PaperMod = window.PaperMod || {};
  PaperMod.state = { once: false };

  PaperMod.initOnce = function () {
    if (PaperMod.state.once) return;
    PaperMod.state.once = true;

    console.log("PaperMod initOnce");

    if (PaperMod.initAPlayer) {
      PaperMod.initAPlayer();
    }
  };

  PaperMod.initPage = function (container = document) {
    console.log("PaperMod initPage");

    PaperMod.initFancybox && PaperMod.initFancybox(container);
    PaperMod.initCodeCopyButtons && PaperMod.initCodeCopyButtons(container);
  };

  barba.init({
    transitions: [
      {
        name: "default",
        leave() {
          return Promise.resolve();
        },
        enter(data) {
          PaperMod.initOnce();
          PaperMod.initPage(data.next.container);
        },
      },
    ],
  });
  
  document.addEventListener("DOMContentLoaded", () => {
    PaperMod.initOnce();
    PaperMod.initPage(document);
  });
</script>







<link
  href="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.css"
  rel="stylesheet"
/>
<script src="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/meting/2.0.2/Meting.min.js"></script>
<script>
  window.PaperMod = window.PaperMod || {};
  console.log("player.js loaded");
  PaperMod.initAPlayer = async function () {
    if (window.__aplayer_inited__) {
      console.log("APlayer already exists, skip");
      return;
    }

    const container = document.getElementById("aplayer");
    if (!container) {
      console.warn("APlayer container not found");
      return;
    }

    console.log("Init APlayer");
    

    const localAudio = [
      
      
      
      
      
      
      
      
    ];

    

    let metingAudio = [];
    try {
      const res = await fetch(
        
        
        "https://api.qijieya.cn/meting/?type=playlist&id=2245453903"
        
        
      );
      metingAudio = await res.json();
    } catch (e) {
      console.warn("Meting load failed, fallback to local only");
    }

    

    const audioList = [...localAudio, ...metingAudio];

    window.aplayer = new APlayer({
      container,
      fixed: true,
      autoplay: false,
      preload: "auto",
      lrcType: 1,
      
      audio: metingAudio,
    });
    console.log("APlayer created with", audioList.length, "tracks");
  };
</script>



<script>
  window.PaperMod = window.PaperMod || {};

  PaperMod.initCodeCopyButtons = function (root = document) {
    root.querySelectorAll("pre > code").forEach((codeblock) => {
      const container = codeblock.parentNode.parentNode;

      
      if (container.querySelector(".copy-code")) return;

      const copybutton = document.createElement("button");
      copybutton.classList.add("copy-code");
      copybutton.innerHTML = '复制';

      function copyingDone() {
        copybutton.innerHTML = '已复制！';
        setTimeout(() => {
          copybutton.innerHTML = '复制';
        }, 2000);
      }

      copybutton.addEventListener("click", (cb) => {
        if ("clipboard" in navigator) {
          navigator.clipboard.writeText(codeblock.textContent);
          copyingDone();
          return;
        }

        const range = document.createRange();
        range.selectNodeContents(codeblock);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        try {
          document.execCommand("copy");
          copyingDone();
        } catch (e) {}
        selection.removeRange(range);
      });
      container.appendChild(copybutton);
    });
  };
</script>


<link rel="stylesheet" href="/lib/fancybox/fancybox.css" />
<script src="/lib/fancybox/fancybox.umd.js"></script>
<script>
  function initFancybox() {
    Fancybox.unbind("[data-fancybox]");

    Fancybox.bind("[data-fancybox]", {
      animated: true,
      showClass: "fancybox-fadeIn",
      hideClass: "fancybox-fadeOut",
      dragToClose: true,
    });
  }

  
  if (document.readyState !== "loading") {
    initFancybox();
  } else {
    document.addEventListener("DOMContentLoaded", initFancybox);
  }
  
  document.addEventListener("barba:afterEnter", initFancybox);
</script>







<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = '复制';

        function copyingDone() {
            copybutton.innerHTML = '已复制！';
            setTimeout(() => {
                copybutton.innerHTML = '复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
